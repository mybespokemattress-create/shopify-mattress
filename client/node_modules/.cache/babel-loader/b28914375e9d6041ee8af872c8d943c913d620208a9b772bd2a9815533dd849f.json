{"ast":null,"code":"import _objectSpread from\"C:/Users/Angelo/shopify-mattress-processor/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Download,Mail,Edit3,Save,X,Upload,Trash2,AlertTriangle,RefreshCw}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const FirmnessOverrideSection=_ref=>{let{selectedOrder,onSupplierCodeUpdate,editMode}=_ref;const[overrideData,setOverrideData]=useState({needsOverride:false,options:[],mattressType:null,skuPrefix:null,loading:false});const[selectedOverride,setSelectedOverride]=useState('');const[applying,setApplying]=useState(false);const[overrideStatus,setOverrideStatus]=useState(null);// Check override status when selectedOrder changes or when entering edit mode\nuseEffect(()=>{if(selectedOrder!==null&&selectedOrder!==void 0&&selectedOrder.id&&editMode){checkOverrideStatus();}else{setOverrideData({needsOverride:false,options:[],mattressType:null,skuPrefix:null,loading:false});setOverrideStatus(null);}},[selectedOrder===null||selectedOrder===void 0?void 0:selectedOrder.id,editMode]);const checkOverrideStatus=async()=>{if(!(selectedOrder!==null&&selectedOrder!==void 0&&selectedOrder.id))return;setOverrideData(prev=>_objectSpread(_objectSpread({},prev),{},{loading:true}));try{// Get available firmness options (this will work for any mattress)\nconst optionsResponse=await fetch(\"/api/orders/\".concat(selectedOrder.id,\"/firmness-options\"));if(!optionsResponse.ok)throw new Error('Failed to get firmness options');const optionsData=await optionsResponse.json();setOverrideData({needsOverride:false,// Always show as available, not required\noptions:optionsData.options,mattressType:optionsData.mattressType,skuPrefix:optionsData.skuPrefix,loading:false});// Set current selection based on existing override or detect from supplier code\nconst statusResponse=await fetch(\"/api/orders/\".concat(selectedOrder.id,\"/override-status\"));if(statusResponse.ok){const status=await statusResponse.json();setOverrideStatus(status);if(status.appliedOverride){setSelectedOverride(\"\".concat(status.appliedOverride.depth,\" - \").concat(status.appliedOverride.firmness));}}}catch(error){console.error('Error checking override status:',error);setOverrideData(prev=>_objectSpread(_objectSpread({},prev),{},{loading:false}));}};const applyOverride=async()=>{if(!selectedOverride)return;// Debug logging\nconsole.log('Selected override:',selectedOverride);console.log('SKU prefix:',overrideData.skuPrefix);const parts=selectedOverride.split(' - ');if(parts.length!==2){return;}const depth=parts[0];const firmness=parts[1];console.log('Sending depth:',depth);console.log('Sending firmness:',firmness);setApplying(true);try{const response=await fetch(\"/api/orders/\".concat(selectedOrder.id,\"/override-firmness\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({depth:depth,firmness:firmness,skuPrefix:overrideData.skuPrefix// âœ… Send the detected prefix\n})});if(!response.ok){const errorData=await response.json();throw new Error(errorData.error||'Override failed');}const result=await response.json();// Update the supplier code in the parent component\nonSupplierCodeUpdate(result.newSupplierCode);// Update our local state\nsetOverrideStatus(prev=>_objectSpread(_objectSpread({},prev),{},{overrideApplied:true,appliedOverride:{depth,firmness}}));}catch(error){console.error('Error applying override:',error);}finally{setApplying(false);}};// Don't render if no order selected or not in edit mode\nif(!selectedOrder||!editMode)return null;// Loading state\nif(overrideData.loading){return/*#__PURE__*/_jsx(\"div\",{className:\"border rounded-lg p-4 bg-blue-50 mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"h-4 w-4 animate-spin text-blue-600\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-blue-900\",children:\"Loading Firmness Options...\"})]})});}// Debug logging\nconsole.log('DEBUG - Order:',selectedOrder.orderNumber);console.log('DEBUG - supplierCode:',\"\\\"\".concat(selectedOrder.supplierCode,\"\\\"\"));console.log('DEBUG - supplierCode type:',typeof selectedOrder.supplierCode);console.log('DEBUG - overrideData.options:',overrideData.options);console.log('DEBUG - editMode:',editMode);// Show override interface if we have options\nif(overrideData.options&&overrideData.options.length>0||!selectedOrder.supplierCode||selectedOrder.supplierCode.trim()===''||selectedOrder.supplierCode==='-'){return/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4 bg-green-50 border-green-200 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-2 w-2 bg-green-500 rounded-full\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-green-900\",children:\"Firmness Override Available\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-green-800 mb-3\",children:[\"Adjust firmness for \",/*#__PURE__*/_jsx(\"strong\",{children:overrideData.mattressType}),\" mattress. Current supplier code will be regenerated.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-green-900 mb-2\",children:\"Select Depth & Firmness:\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedOverride,onChange:e=>setSelectedOverride(e.target.value),className:\"w-full p-3 border border-green-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Select depth and firmness --\"}),overrideData.options.map(option=>/*#__PURE__*/_jsx(\"option\",{value:option.label,children:option.label},option.value))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:checkOverrideStatus,className:\"px-3 py-2 text-sm border border-green-300 rounded text-green-700 hover:bg-green-100\",children:\"Refresh Options\"}),/*#__PURE__*/_jsx(\"button\",{onClick:applyOverride,disabled:!selectedOverride||applying,className:\"px-4 py-2 text-sm rounded text-white font-medium \".concat(selectedOverride&&!applying?'bg-green-600 hover:bg-green-700':'bg-gray-400 cursor-not-allowed'),children:applying?'Applying...':'Apply Override'})]}),(overrideStatus===null||overrideStatus===void 0?void 0:overrideStatus.appliedOverride)&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-green-600 mt-2\",children:[\"Last applied: \",overrideStatus.appliedOverride.depth,\" - \",overrideStatus.appliedOverride.firmness,overrideStatus.overrideTimestamp&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2\",children:[\"(\",new Date(overrideStatus.overrideTimestamp).toLocaleString(),\")\"]})]})]})]});}return null;};const OrderProcessor=()=>{var _selectedOrder$lineIt1,_selectedOrder$lineIt10;const[orders,setOrders]=useState([]);const[selectedOrder,setSelectedOrder]=useState(null);const[editMode,setEditMode]=useState(false);const[searchTerm,setSearchTerm]=useState('');const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// New state for diagram upload\nconst[uploadingDiagram,setUploadingDiagram]=useState(false);const[selectedFile,setSelectedFile]=useState(null);const[storageStatus,setStorageStatus]=useState(null);const[uploadProgress,setUploadProgress]=useState(0);const getDiagramImageUrl=diagramNumber=>{if(!diagramNumber)return null;return\"/images/diagrams/Shape_\".concat(diagramNumber,\"_Caravan_Mattress_Measuring_Diagram.jpg\");};// Check storage status\nconst checkStorageStatus=async()=>{try{const response=await fetch('/api/diagrams/storage-status');if(response.ok){const status=await response.json();setStorageStatus(status);}}catch(error){console.error('Failed to check storage status:',error);}};// Handle file selection\nconst handleFileSelect=event=>{const file=event.target.files[0];if(file){// Validate file size and type on frontend\nconst maxSize=5*1024*1024;// 5MB\nconst allowedTypes=['image/jpeg','image/png','application/pdf'];if(file.size>maxSize){alert('File too large. Maximum size is 5MB.');return;}if(!allowedTypes.includes(file.type)){alert('Invalid file type. Only JPG, PNG, and PDF files are allowed.');return;}setSelectedFile(file);}};// Upload diagram\nconst handleDiagramUpload=async()=>{if(!selectedFile)return;setUploadingDiagram(true);setUploadProgress(0);try{const formData=new FormData();formData.append('diagram',selectedFile);const response=await fetch(\"/api/diagrams/\".concat(selectedOrder.id,\"/upload-diagram\"),{method:'POST',body:formData});if(!response.ok){const errorData=await response.json();throw new Error(errorData.error||'Upload failed');}const result=await response.json();// Update selected order with new diagram info\nsetSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{has_custom_diagram:true,custom_diagram_url:result.url,custom_diagram_filename:result.filename}));// Update orders list\nsetOrders(orders.map(order=>order.id===selectedOrder.id?_objectSpread(_objectSpread({},order),{},{has_custom_diagram:true,custom_diagram_url:result.url}):order));// Update storage status\nif(result.storage){setStorageStatus(result.storage);}setSelectedFile(null);alert('Diagram uploaded successfully!');}catch(error){console.error('Upload error:',error);alert(\"Upload failed: \".concat(error.message));}finally{setUploadingDiagram(false);setUploadProgress(0);}};// Remove diagram\nconst handleDiagramRemove=async()=>{if(!confirm('Are you sure you want to remove this custom diagram?')){return;}try{const response=await fetch(\"/api/diagrams/\".concat(selectedOrder.id,\"/diagram\"),{method:'DELETE'});if(!response.ok){throw new Error('Failed to remove diagram');}// Update selected order\nsetSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{has_custom_diagram:false,custom_diagram_url:null,custom_diagram_filename:null}));// Update orders list\nsetOrders(orders.map(order=>order.id===selectedOrder.id?_objectSpread(_objectSpread({},order),{},{has_custom_diagram:false,custom_diagram_url:null}):order));alert('Diagram removed successfully!');}catch(error){console.error('Remove error:',error);alert(\"Failed to remove diagram: \".concat(error.message));}};const transformApiOrder=apiOrder=>{var _apiOrder$order_data,_apiOrder$order_data2,_apiOrder$order_data3,_apiOrder$order_data4,_apiOrder$order_data5,_apiOrder$order_data6,_apiOrder$order_data7,_apiOrder$line_items,_apiOrder$line_items$,_lineItems$,_lineItems$2,_apiOrder$line_items2,_apiOrder$line_items3;// ADD THIS DEBUG BLOCK RIGHT HERE - AT THE START OF THE FUNCTION\nconsole.group('ðŸ” Coolplus Debug - Order:',apiOrder.order_number);console.log('Full apiOrder object:',apiOrder);console.log('line_items exists?',!!apiOrder.line_items);console.log('line_items content:',apiOrder.line_items);if(apiOrder.line_items&&apiOrder.line_items[0]){console.log('First line item:',apiOrder.line_items[0]);console.log('Specification field:',apiOrder.line_items[0].specification);console.log('Type of specification:',typeof apiOrder.line_items[0].specification);}console.log('order_data:',apiOrder.order_data);console.log('order_data.supplierSpecification:',(_apiOrder$order_data=apiOrder.order_data)===null||_apiOrder$order_data===void 0?void 0:_apiOrder$order_data.supplierSpecification);console.groupEnd();// END OF DEBUG BLOCK\nconst orderData=apiOrder.order_data||{};let diagramNumber=null;const lineItems=(_apiOrder$order_data2=apiOrder.order_data)===null||_apiOrder$order_data2===void 0?void 0:(_apiOrder$order_data3=_apiOrder$order_data2.order_data)===null||_apiOrder$order_data3===void 0?void 0:_apiOrder$order_data3.line_items;if(lineItems&&lineItems[0]&&lineItems[0].properties){const diagramProperty=lineItems[0].properties.find(prop=>prop.name==='Diagram Number');diagramNumber=diagramProperty?diagramProperty.value:null;}let linkAttachment='One Piece Mattress No Link Required';let deliveryOption='Rolled and Boxed';if(lineItems&&lineItems[0]&&lineItems[0].variant_title){const variantTitle=lineItems[0].variant_title;const productTitle=lineItems[0].title||lineItems[0].name||'';if(variantTitle.includes('Leave Bolster Loose')){linkAttachment='Leave Bolster Loose';}else if(variantTitle.includes('Leave Sections Loose')){linkAttachment='Leave Sections Loose';}else if(variantTitle.includes('Fabric Link')){linkAttachment='Fabric Link (+Â£40)';}else if(variantTitle.includes('Zip-Link')){linkAttachment='Zip-Link (+Â£40)';}else{if(productTitle.toLowerCase().includes('bolster')){linkAttachment='Leave Bolster Loose';}else if(productTitle.toLowerCase().includes('section')){linkAttachment='Leave Sections Loose';}else{linkAttachment='One Piece Mattress No Link Required';}}}const measurements=((_apiOrder$order_data4=apiOrder.order_data)===null||_apiOrder$order_data4===void 0?void 0:(_apiOrder$order_data5=_apiOrder$order_data4.order_data)===null||_apiOrder$order_data5===void 0?void 0:(_apiOrder$order_data6=_apiOrder$order_data5.extracted_measurements)===null||_apiOrder$order_data6===void 0?void 0:(_apiOrder$order_data7=_apiOrder$order_data6[0])===null||_apiOrder$order_data7===void 0?void 0:_apiOrder$order_data7.measurements)||{};const properties={};const dimensions=['A','B','C','D','E','F','G'];dimensions.forEach(dim=>{// First try to get from saved database columns\nconst savedDimension=apiOrder[\"dimension_\".concat(dim.toLowerCase())];if(savedDimension){properties[\"Dimension \".concat(dim)]=savedDimension;}else{// Fall back to original measurements extraction\nconst measurement=measurements[dim];if(measurement){if(typeof measurement==='object'&&'value'in measurement){const displayValue=measurement.unit?\"\".concat(measurement.value,\" \").concat(measurement.unit):measurement.value;properties[\"Dimension \".concat(dim)]=displayValue;}else{properties[\"Dimension \".concat(dim)]=String(measurement);}}else{properties[\"Dimension \".concat(dim)]='';}}});// ADD THIS DEBUG LINE RIGHT BEFORE THE RETURN\nconst finalSupplierCode=((_apiOrder$line_items=apiOrder.line_items)===null||_apiOrder$line_items===void 0?void 0:(_apiOrder$line_items$=_apiOrder$line_items[0])===null||_apiOrder$line_items$===void 0?void 0:_apiOrder$line_items$.specification)||orderData.supplierSpecification||'';console.log('ðŸ“Œ Final supplierCode being set:',finalSupplierCode);return{id:apiOrder.id.toString(),orderNumber:apiOrder.order_number||'Unknown',customer:{name:apiOrder.customer_name||'Unknown Customer',email:apiOrder.customer_email||''},orderDate:apiOrder.created_date?new Date(apiOrder.created_date).toISOString().split('T')[0]:'',status:apiOrder.processing_status==='received'?'pending_review':'ready_to_send',emailSent:apiOrder.email_sent||false,lineItems:[{sku:orderData.sku||(lineItems===null||lineItems===void 0?void 0:(_lineItems$=lineItems[0])===null||_lineItems$===void 0?void 0:_lineItems$.sku)||'Unknown SKU',productTitle:(lineItems===null||lineItems===void 0?void 0:(_lineItems$2=lineItems[0])===null||_lineItems$2===void 0?void 0:_lineItems$2.title)||'Unknown Product',quantity:1,properties:properties}],supplierCode:apiOrder.supplier_code||((_apiOrder$line_items2=apiOrder.line_items)===null||_apiOrder$line_items2===void 0?void 0:(_apiOrder$line_items3=_apiOrder$line_items2[0])===null||_apiOrder$line_items3===void 0?void 0:_apiOrder$line_items3.specification)||orderData.supplierSpecification||'',shapeNumber:orderData.shapeNumber||'',diagramNumber:diagramNumber,shapeDiagramUrl:getDiagramImageUrl(diagramNumber),linkAttachment:apiOrder.link_attachment||linkAttachment,deliveryOption:apiOrder.delivery_option||deliveryOption,radiusTopCorner:apiOrder.radius_top_corner||'',radiusBottomCorner:apiOrder.radius_bottom_corner||'',finishedSizeMax:apiOrder.finished_size_max||'',totalPrice:apiOrder.total_price,supplierName:apiOrder.supplier_name||orderData.supplierName,rawMeasurements:measurements,notes:apiOrder.notes||'',mattressLabel:apiOrder.mattress_label||'CaravanMattresses',// Add custom diagram fields\nhas_custom_diagram:apiOrder.has_custom_diagram||false,custom_diagram_url:apiOrder.custom_diagram_url||null,custom_diagram_filename:apiOrder.custom_diagram_url?apiOrder.custom_diagram_url.split('/').pop():null};};const fetchOrders=async()=>{try{var _apiResponse$orders;setLoading(true);setError(null);const response=await fetch('/api/orders');if(!response.ok){throw new Error(\"Failed to fetch orders: \".concat(response.status));}const apiResponse=await response.json();// ADD THIS DEBUG BLOCK HERE\nconsole.group('ðŸŒ API Response Debug');console.log('Full API response:',apiResponse);console.log('Number of orders:',(_apiResponse$orders=apiResponse.orders)===null||_apiResponse$orders===void 0?void 0:_apiResponse$orders.length);if(apiResponse.orders&&apiResponse.orders[0]){console.log('First order from API:',apiResponse.orders[0]);console.log('First order line_items:',apiResponse.orders[0].line_items);}console.groupEnd();// END OF DEBUG BLOCK\nconst ordersArray=apiResponse.orders||[];const transformedOrders=ordersArray.map(transformApiOrder);setOrders(transformedOrders);}catch(err){console.error('Error fetching orders:',err);setError(err.message);}finally{setLoading(false);}};useEffect(()=>{fetchOrders();checkStorageStatus();const interval=setInterval(()=>{if(!editMode){fetchOrders();}},30000);return()=>clearInterval(interval);},[editMode]);const handleOrderSelect=order=>{if((selectedOrder===null||selectedOrder===void 0?void 0:selectedOrder.id)===order.id){setSelectedOrder(null);setEditMode(false);}else{setSelectedOrder(_objectSpread({},order));setEditMode(false);setSelectedFile(null);// Clear any selected file\n}};const handleEdit=()=>setEditMode(true);const handleSave=async()=>{try{var _selectedOrder$lineIt,_selectedOrder$lineIt2,_selectedOrder$lineIt3,_selectedOrder$lineIt4,_selectedOrder$lineIt5,_selectedOrder$lineIt6,_selectedOrder$lineIt7,_selectedOrder$lineIt8,_selectedOrder$lineIt9,_selectedOrder$lineIt0;const response=await fetch(\"/api/orders/\".concat(selectedOrder.id),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({processing_status:selectedOrder.status==='ready_to_send'?'processed':'received',notes:selectedOrder.notes,mattress_label:selectedOrder.mattressLabel,order_number:selectedOrder.orderNumber,customer_name:selectedOrder.customer.name,customer_email:selectedOrder.customer.email,order_date:selectedOrder.orderDate,supplier_code:selectedOrder.supplierCode,product_sku:(_selectedOrder$lineIt=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt===void 0?void 0:_selectedOrder$lineIt.sku,quantity:(_selectedOrder$lineIt2=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt2===void 0?void 0:_selectedOrder$lineIt2.quantity,dimension_a:(_selectedOrder$lineIt3=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt3===void 0?void 0:_selectedOrder$lineIt3.properties['Dimension A'],dimension_b:(_selectedOrder$lineIt4=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt4===void 0?void 0:_selectedOrder$lineIt4.properties['Dimension B'],dimension_c:(_selectedOrder$lineIt5=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt5===void 0?void 0:_selectedOrder$lineIt5.properties['Dimension C'],dimension_d:(_selectedOrder$lineIt6=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt6===void 0?void 0:_selectedOrder$lineIt6.properties['Dimension D'],dimension_e:(_selectedOrder$lineIt7=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt7===void 0?void 0:_selectedOrder$lineIt7.properties['Dimension E'],dimension_f:(_selectedOrder$lineIt8=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt8===void 0?void 0:_selectedOrder$lineIt8.properties['Dimension F'],dimension_g:(_selectedOrder$lineIt9=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt9===void 0?void 0:_selectedOrder$lineIt9.properties['Dimension G'],radius_top_corner:selectedOrder.radiusTopCorner,radius_bottom_corner:selectedOrder.radiusBottomCorner,finished_size_max:selectedOrder.finishedSizeMax,link_attachment:selectedOrder.linkAttachment,delivery_option:selectedOrder.deliveryOption,measurements:((_selectedOrder$lineIt0=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt0===void 0?void 0:_selectedOrder$lineIt0.properties)||{}})});const result=await response.json();console.log('Save response:',result);if(!response.ok){throw new Error(\"Server error: \".concat(response.status));}setOrders(orders.map(order=>order.id===selectedOrder.id?selectedOrder:order));setEditMode(false);}catch(err){console.error('Error saving order:',err);}};const handleCancel=()=>{const originalOrder=orders.find(order=>order.id===selectedOrder.id);setSelectedOrder(_objectSpread({},originalOrder));setEditMode(false);setSelectedFile(null);// Clear any selected file\n};const updateOrderField=(field,value)=>{setSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));};const updateCustomerField=(field,value)=>{setSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{customer:_objectSpread(_objectSpread({},prev.customer),{},{[field]:value})}));};const updateMeasurement=(dimension,value)=>{setSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{lineItems:prev.lineItems.map(item=>_objectSpread(_objectSpread({},item),{},{properties:_objectSpread(_objectSpread({},item.properties),{},{[dimension]:value})}))}));};const updateAdditionalField=(field,value)=>{setSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));};const generatePDF=async()=>{try{console.log('Generating PDF for order:',selectedOrder.orderNumber);const response=await fetch('/api/pdf/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({order:selectedOrder})});if(!response.ok){throw new Error('Failed to generate PDF');}const blob=await response.blob();const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"Order_\".concat(selectedOrder.orderNumber,\"_\").concat(selectedOrder.customer.name.replace(/\\s+/g,'_'),\".pdf\");document.body.appendChild(a);a.click();document.body.removeChild(a);window.URL.revokeObjectURL(url);}catch(err){console.error('Error generating PDF:',err);alert('Failed to generate PDF');}};const getSupplierEmail=supplierName=>{const supplierEmails={'Southern Production':'mbm@southernfoam.co.uk','Mattressshire Production':'mattressshire.wmltd@gmail.com'};return supplierEmails[supplierName]||'angelo@mybespokemattress.com';};const openZohoMail=()=>{console.log('Supplier name:',selectedOrder.supplierName);const supplierEmail=getSupplierEmail(selectedOrder.supplierName);const subject=\"Purchase Order \".concat(selectedOrder.orderNumber,\" - \").concat(selectedOrder.customer.name);// Official Zoho compose URL\nwindow.open('https://mail.zoho.eu/zm/#compose','_blank');// Create alert with email details to copy\nsetTimeout(()=>{alert(\"Zoho Mail opened. Please copy these details:\\n\\nTO: \".concat(supplierEmail,\"\\nSUBJECT: \").concat(subject,\"\\n\\nThen attach the downloaded PDF and send.\"));},1000);};const markOrderAsSent=async()=>{const response=await fetch(\"/api/orders/\".concat(selectedOrder.id),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({email_sent:true})});if(response.ok){setOrders(orders.map(order=>order.id===selectedOrder.id?_objectSpread(_objectSpread({},order),{},{emailSent:true}):order));setSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{emailSent:true}));}else{alert(\"API Error: \".concat(response.status));}};const filteredOrders=orders.filter(order=>order.orderNumber.toLowerCase().includes(searchTerm.toLowerCase())||order.customer.name.toLowerCase().includes(searchTerm.toLowerCase()));if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-slate-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-slate-600\",children:\"Loading orders...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-slate-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-600 mb-4\",children:[\"Error loading orders: \",error]}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchOrders,className:\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\",children:\"Retry\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-slate-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white border-b shadow-sm\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-7xl mx-auto px-6 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-slate-900\",children:\"Bespoke Mattress Order Processor\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-600 mt-1\",children:\"Review and process Shopify orders before sending to suppliers\"}),storageStatus&&storageStatus.percentage>80&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex items-center gap-2 text-amber-600\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:16}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm\",children:[\"Storage \",storageStatus.percentage,\"% full (\",storageStatus.used,\"/\",storageStatus.limit,\")\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-slate-500\",children:[orders.length,\" orders loaded\",/*#__PURE__*/_jsx(\"button\",{onClick:fetchOrders,className:\"ml-2 px-3 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200\",children:\"Refresh\"})]})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"max-w-7xl mx-auto p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow border\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-b bg-slate-50\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold mb-3\",children:\"Orders Queue\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search orders...\",className:\"w-full px-3 py-2 border rounded-lg\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-96 overflow-y-auto\",children:filteredOrders.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"p-4 text-center text-slate-500\",children:searchTerm?'No orders match your search':'No orders found'}):filteredOrders.map(order=>/*#__PURE__*/_jsx(\"div\",{className:\"p-4 border-b cursor-pointer hover:bg-slate-50 \".concat((selectedOrder===null||selectedOrder===void 0?void 0:selectedOrder.id)===order.id?'bg-blue-50':''),onClick:()=>handleOrderSelect(order),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-sm\",children:order.orderNumber}),order.diagramNumber&&/*#__PURE__*/_jsxs(\"span\",{className:\"px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-700\",children:[\"Shape \",order.diagramNumber]}),order.has_custom_diagram&&/*#__PURE__*/_jsx(\"span\",{className:\"px-1.5 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-700\",children:\"Custom\"}),order.notes&&/*#__PURE__*/_jsx(\"span\",{className:\"px-1.5 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-700\",children:\"Notes\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-600 text-sm\",children:order.customer.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-slate-500 text-xs\",children:order.orderDate}),order.supplierName&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-slate-500 text-xs mt-1\",children:[\"\\u2192 \",order.supplierName]})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded text-xs \".concat(order.emailSent?'bg-green-100 text-green-800':order.status==='ready_to_send'?'bg-yellow-100 text-yellow-800':'bg-grey-100 text-grey-800'),children:order.emailSent?'Sent':order.status==='ready_to_send'?'Ready':'Review'})})]})},order.id))})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-2\",children:selectedOrder?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow border\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-b bg-slate-50 flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold\",children:\"Order Details\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-600\",children:selectedOrder.orderNumber})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2\",children:!editMode?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleEdit,className:\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Edit3,{size:16}),\"Edit\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:generatePDF,className:\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Download,{size:16}),\"Download PDF\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:async()=>{try{// 1. Download PDF locally\nawait generatePDF();// 2. Send test email automatically\nconst emailResponse=await fetch('/api/email/send',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({to:'angelo@mybespokemattress.com',// Your test email\nsubject:\"Purchase Order \".concat(selectedOrder.orderNumber,\" - \").concat(selectedOrder.customer.name),body:\"\\n                                            <h2>New Purchase Order</h2>\\n                                            <p>Dear Supplier,</p>\\n                                            <p>Please find attached a new purchase order:</p>\\n                                            <ul>\\n                                                <li><strong>Order Number:</strong> \".concat(selectedOrder.orderNumber,\"</li>\\n                                                <li><strong>Customer:</strong> \").concat(selectedOrder.customer.name,\"</li>\\n                                            </ul>\\n                                            <p>Kind regards,<br>My Bespoke Order Ltd</p>\\n                                        \"),orderId:selectedOrder.id,orderData:selectedOrder// ADD THIS LINE\n})});if(!emailResponse.ok)throw new Error('Email sending failed');// 3. Mark as sent only if successful\nawait markOrderAsSent();alert('PDF downloaded and email sent successfully!');}catch(error){console.error('Error:',error);alert(\"Failed: \".concat(error.message));}},className:\"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Mail,{size:16}),/*#__PURE__*/_jsx(Download,{size:14}),\"Download and Email\"]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleSave,className:\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Save,{size:16}),\"Save\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleCancel,className:\"px-4 py-2 bg-slate-500 text-white rounded hover:bg-slate-600 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(X,{size:16}),\"Cancel\"]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Customer Notes\"}),/*#__PURE__*/_jsx(\"textarea\",{value:selectedOrder.notes,onChange:e=>updateOrderField('notes',e.target.value),disabled:!editMode,placeholder:\"No customer notes provided\",rows:3,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Order Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Order Number\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:selectedOrder.orderNumber,onChange:e=>updateOrderField('orderNumber',e.target.value),disabled:!editMode,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Order Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:selectedOrder.orderDate,onChange:e=>updateOrderField('orderDate',e.target.value),disabled:!editMode,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Customer Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Customer Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:selectedOrder.customer.name,onChange:e=>updateCustomerField('name',e.target.value),disabled:!editMode,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:selectedOrder.customer.email,onChange:e=>updateCustomerField('email',e.target.value),disabled:!editMode,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Product Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Supplier Code\"}),/*#__PURE__*/_jsx(\"textarea\",{value:selectedOrder.supplierCode,onChange:e=>updateOrderField('supplierCode',e.target.value),disabled:!editMode,rows:2,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100 font-mono text-sm resize-none\"})]}),/*#__PURE__*/_jsx(FirmnessOverrideSection,{selectedOrder:selectedOrder,onSupplierCodeUpdate:newCode=>{setSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{supplierCode:newCode}));setOrders(orders.map(order=>order.id===selectedOrder.id?_objectSpread(_objectSpread({},order),{},{supplierCode:newCode}):order));},editMode:editMode}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Product SKU\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:((_selectedOrder$lineIt1=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt1===void 0?void 0:_selectedOrder$lineIt1.sku)||'Unknown SKU',disabled:true,className:\"w-full px-3 py-2 border rounded bg-slate-100 text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-20\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Qty\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:((_selectedOrder$lineIt10=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt10===void 0?void 0:_selectedOrder$lineIt10.quantity)||1,onChange:e=>{const newQuantity=parseInt(e.target.value)||1;setSelectedOrder(prev=>_objectSpread(_objectSpread({},prev),{},{lineItems:prev.lineItems.map((item,index)=>index===0?_objectSpread(_objectSpread({},item),{},{quantity:newQuantity}):item)}));},disabled:!editMode,className:\"w-full px-2 py-2 border rounded disabled:bg-slate-100 text-center\",min:\"1\",max:\"99\"})]})]}),selectedOrder.supplierName&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 text-sm text-slate-600\",children:[\"Assigned to: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:selectedOrder.supplierName})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Measurements & Shape Diagram\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm text-slate-600 mb-3\",children:\"Dimensions\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:['Dimension A','Dimension B','Dimension C','Dimension D','Dimension E','Dimension F','Dimension G'].map(dimension=>{var _selectedOrder$lineIt11;const value=((_selectedOrder$lineIt11=selectedOrder.lineItems[0])===null||_selectedOrder$lineIt11===void 0?void 0:_selectedOrder$lineIt11.properties[dimension])||'';const hasValue=value&&value!=='';return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"w-6 text-sm font-medium text-center\",children:dimension.replace('Dimension ','')}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:value,onChange:e=>updateMeasurement(dimension,e.target.value),disabled:!editMode,placeholder:\"Not provided\",className:\"flex-1 px-3 py-2 border rounded disabled:bg-slate-100 font-mono \".concat(hasValue?'text-slate-900':'text-slate-400')}),hasValue&&!editMode&&/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-green-600\",children:\"\\u2713\"})]},dimension);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 pt-4 border-t\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm text-slate-600 mb-3\",children:\"Additional Specifications\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Radius of Top Corner\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:selectedOrder.radiusTopCorner||'',onChange:e=>updateAdditionalField('radiusTopCorner',e.target.value),disabled:!editMode,placeholder:\"Enter radius\",className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Radius of Bottom Corner\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:selectedOrder.radiusBottomCorner||'',onChange:e=>updateAdditionalField('radiusBottomCorner',e.target.value),disabled:!editMode,placeholder:\"Enter radius\",className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Finished Size Must Not Exceed\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:selectedOrder.finishedSizeMax||'',onChange:e=>updateAdditionalField('finishedSizeMax',e.target.value),disabled:!editMode,placeholder:\"Enter maximum size\",className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-sm text-slate-600 mb-3\",children:[\"Shape Diagram\",selectedOrder.diagramNumber&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium\",children:[\"Shape \",selectedOrder.diagramNumber]}),selectedOrder.has_custom_diagram&&/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium\",children:\"Custom Diagram\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border rounded bg-slate-50\",style:{height:'400px'},children:selectedOrder.has_custom_diagram&&selectedOrder.custom_diagram_url?/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-full\",children:[/*#__PURE__*/_jsx(\"img\",{src:selectedOrder.custom_diagram_url,alt:\"Custom diagram for order \".concat(selectedOrder.orderNumber),className:\"w-full h-full object-contain\",onError:e=>{console.error('Custom diagram failed to load:',selectedOrder.custom_diagram_url);e.target.style.display='none';e.target.nextSibling.style.display='flex';}}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-full flex-col items-center justify-center text-slate-400 hidden\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm mb-1\",children:\"Custom diagram failed to load\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs\",children:selectedOrder.custom_diagram_filename})]})]}):selectedOrder.shapeDiagramUrl?/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-full\",children:[/*#__PURE__*/_jsx(\"img\",{src:selectedOrder.shapeDiagramUrl,alt:\"Shape \".concat(selectedOrder.diagramNumber,\" Measuring Diagram\"),className:\"w-full h-full object-contain\",onError:e=>{console.error('Diagram failed to load:',selectedOrder.shapeDiagramUrl);e.target.style.display='none';e.target.nextSibling.style.display='flex';}}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-full flex-col items-center justify-center text-slate-400 hidden\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm mb-1\",children:\"Diagram failed to load\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs\",children:[\"Shape #\",selectedOrder.diagramNumber]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs mt-2 text-slate-300\",children:[\"Check: /images/diagrams/Shape_\",selectedOrder.diagramNumber,\"_Caravan_Mattress_Measuring_Diagram.jpg\"]})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"w-full h-full flex flex-col items-center justify-center text-slate-400\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm mb-1\",children:selectedOrder.diagramNumber?'Diagram configured but not accessible':'No diagram specified'}),selectedOrder.diagramNumber&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs\",children:[\"Shape #\",selectedOrder.diagramNumber]}),!selectedOrder.diagramNumber&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs mt-2 text-slate-300\",children:\"Diagram number not found in order properties\"})]})}),editMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 border-t pt-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-sm font-medium mb-2\",children:\"Upload Custom Diagram\"}),storageStatus&&storageStatus.percentage>80&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2 p-2 bg-yellow-100 text-yellow-800 rounded text-sm flex items-center gap-2\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:16}),\"Warning: Storage is \",storageStatus.percentage,\"% full (\",storageStatus.used,\"/\",storageStatus.limit,\")\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".jpg,.jpeg,.png,.pdf\",onChange:handleFileSelect,className:\"mb-2 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"}),selectedFile&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2 p-2 bg-blue-50 rounded\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-800\",children:[\"Selected: \",selectedFile.name,\" (\",(selectedFile.size/1024/1024).toFixed(2),\"MB)\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mt-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleDiagramUpload,disabled:uploadingDiagram,className:\"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 disabled:opacity-50 flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Upload,{size:14}),uploadingDiagram?'Uploading...':'Upload Diagram']}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedFile(null),className:\"px-3 py-1 bg-slate-500 text-white rounded text-sm hover:bg-slate-600\",children:\"Cancel\"})]})]}),selectedOrder.has_custom_diagram&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-2 bg-green-50 rounded\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-green-800 mb-2\",children:[\"Custom diagram uploaded: \",selectedOrder.custom_diagram_filename]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleDiagramRemove,className:\"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700 flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Trash2,{size:14}),\"Remove Custom Diagram\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-xs text-slate-500\",children:\"Supported formats: JPG, PNG, PDF. Maximum size: 5MB.\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Manufacturing Options\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Link Attachment\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedOrder.linkAttachment,onChange:e=>updateOrderField('linkAttachment',e.target.value),disabled:!editMode,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"One Piece Construction\",children:\"One Piece Mattress No Link Required\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Leave Sections Loose\",children:\"Leave Sections Loose\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Leave Bolster Loose\",children:\"Leave Bolster Loose\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Fabric Link (+\\xA340)\",children:\"Fabric Link (+\\xA340)\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Zip-Link (+\\xA340)\",children:\"Zip-Link (+\\xA340)\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm text-slate-600 mb-1\",children:\"Delivery Option\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedOrder.deliveryOption,onChange:e=>updateOrderField('deliveryOption',e.target.value),disabled:!editMode,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"Rolled and Boxed\",children:\"Rolled and Boxed\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Full Size Ready to Use\",children:\"Full Size Ready to Use\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Mattress Label\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedOrder.mattressLabel,onChange:e=>updateOrderField('mattressLabel',e.target.value),disabled:!editMode,className:\"w-full px-3 py-2 border rounded disabled:bg-slate-100\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"CaravanMattresses\",children:\"Caravan Mattresses\"}),/*#__PURE__*/_jsx(\"option\",{value:\"MotorhomeMattresses\",children:\"Motorhome Mattresses\"}),/*#__PURE__*/_jsx(\"option\",{value:\"MyBespokeMattresses\",children:\"My Bespoke Mattresses\"})]})]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow border p-8 text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-slate-400\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"mx-auto h-12 w-12 mb-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:1,d:\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-slate-900 mb-2\",children:\"Select an Order\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500\",children:\"Choose an order from the list to view and edit its details.\"})]})})})]})})]});};export default OrderProcessor;","map":{"version":3,"names":["React","useState","useEffect","Download","Mail","Edit3","Save","X","Upload","Trash2","AlertTriangle","RefreshCw","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","FirmnessOverrideSection","_ref","selectedOrder","onSupplierCodeUpdate","editMode","overrideData","setOverrideData","needsOverride","options","mattressType","skuPrefix","loading","selectedOverride","setSelectedOverride","applying","setApplying","overrideStatus","setOverrideStatus","id","checkOverrideStatus","prev","_objectSpread","optionsResponse","fetch","concat","ok","Error","optionsData","json","statusResponse","status","appliedOverride","depth","firmness","error","console","applyOverride","log","parts","split","length","response","method","headers","body","JSON","stringify","errorData","result","newSupplierCode","overrideApplied","className","children","orderNumber","supplierCode","trim","value","onChange","e","target","map","option","label","onClick","disabled","overrideTimestamp","Date","toLocaleString","OrderProcessor","_selectedOrder$lineIt1","_selectedOrder$lineIt10","orders","setOrders","setSelectedOrder","setEditMode","searchTerm","setSearchTerm","setLoading","setError","uploadingDiagram","setUploadingDiagram","selectedFile","setSelectedFile","storageStatus","setStorageStatus","uploadProgress","setUploadProgress","getDiagramImageUrl","diagramNumber","checkStorageStatus","handleFileSelect","event","file","files","maxSize","allowedTypes","size","alert","includes","type","handleDiagramUpload","formData","FormData","append","has_custom_diagram","custom_diagram_url","url","custom_diagram_filename","filename","order","storage","message","handleDiagramRemove","confirm","transformApiOrder","apiOrder","_apiOrder$order_data","_apiOrder$order_data2","_apiOrder$order_data3","_apiOrder$order_data4","_apiOrder$order_data5","_apiOrder$order_data6","_apiOrder$order_data7","_apiOrder$line_items","_apiOrder$line_items$","_lineItems$","_lineItems$2","_apiOrder$line_items2","_apiOrder$line_items3","group","order_number","line_items","specification","order_data","supplierSpecification","groupEnd","orderData","lineItems","properties","diagramProperty","find","prop","name","linkAttachment","deliveryOption","variant_title","variantTitle","productTitle","title","toLowerCase","measurements","extracted_measurements","dimensions","forEach","dim","savedDimension","measurement","displayValue","unit","String","finalSupplierCode","toString","customer","customer_name","email","customer_email","orderDate","created_date","toISOString","processing_status","emailSent","email_sent","sku","quantity","supplier_code","shapeNumber","shapeDiagramUrl","link_attachment","delivery_option","radiusTopCorner","radius_top_corner","radiusBottomCorner","radius_bottom_corner","finishedSizeMax","finished_size_max","totalPrice","total_price","supplierName","supplier_name","rawMeasurements","notes","mattressLabel","mattress_label","pop","fetchOrders","_apiResponse$orders","apiResponse","ordersArray","transformedOrders","err","interval","setInterval","clearInterval","handleOrderSelect","handleEdit","handleSave","_selectedOrder$lineIt","_selectedOrder$lineIt2","_selectedOrder$lineIt3","_selectedOrder$lineIt4","_selectedOrder$lineIt5","_selectedOrder$lineIt6","_selectedOrder$lineIt7","_selectedOrder$lineIt8","_selectedOrder$lineIt9","_selectedOrder$lineIt0","order_date","product_sku","dimension_a","dimension_b","dimension_c","dimension_d","dimension_e","dimension_f","dimension_g","handleCancel","originalOrder","updateOrderField","field","updateCustomerField","updateMeasurement","dimension","item","updateAdditionalField","generatePDF","blob","window","URL","createObjectURL","a","document","createElement","href","download","replace","appendChild","click","removeChild","revokeObjectURL","getSupplierEmail","supplierEmails","openZohoMail","supplierEmail","subject","open","setTimeout","markOrderAsSent","filteredOrders","filter","percentage","used","limit","placeholder","emailResponse","to","orderId","rows","newCode","newQuantity","parseInt","index","min","max","_selectedOrder$lineIt11","hasValue","style","height","src","alt","onError","display","nextSibling","accept","toFixed","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d"],"sources":["C:/Users/Angelo/shopify-mattress-processor/client/src/components/OrderProcessor.jsx"],"sourcesContent":["\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Download, Mail, Edit3, Save, X, Upload, Trash2, AlertTriangle, RefreshCw } from 'lucide-react';\r\n\r\nconst FirmnessOverrideSection = ({ \r\n  selectedOrder, \r\n  onSupplierCodeUpdate, \r\n  editMode \r\n}) => {\r\n  const [overrideData, setOverrideData] = useState({\r\n    needsOverride: false,\r\n    options: [],\r\n    mattressType: null,\r\n    skuPrefix: null,\r\n    loading: false\r\n  });\r\n  \r\n  const [selectedOverride, setSelectedOverride] = useState('');\r\n  const [applying, setApplying] = useState(false);\r\n  const [overrideStatus, setOverrideStatus] = useState(null);\r\n\r\n  // Check override status when selectedOrder changes or when entering edit mode\r\n  useEffect(() => {\r\n    if (selectedOrder?.id && editMode) {\r\n      checkOverrideStatus();\r\n    } else {\r\n      setOverrideData({ needsOverride: false, options: [], mattressType: null, skuPrefix: null, loading: false });\r\n      setOverrideStatus(null);\r\n    }\r\n  }, [selectedOrder?.id, editMode]);\r\n\r\n  const checkOverrideStatus = async () => {\r\n    if (!selectedOrder?.id) return;\r\n    \r\n    setOverrideData(prev => ({ ...prev, loading: true }));\r\n    \r\n    try {\r\n\r\n      // Get available firmness options (this will work for any mattress)\r\n      const optionsResponse = await fetch(`/api/orders/${selectedOrder.id}/firmness-options`);\r\n      if (!optionsResponse.ok) throw new Error('Failed to get firmness options');\r\n      \r\n      const optionsData = await optionsResponse.json();\r\n      \r\n      setOverrideData({\r\n        needsOverride: false, // Always show as available, not required\r\n        options: optionsData.options,\r\n        mattressType: optionsData.mattressType,\r\n        skuPrefix: optionsData.skuPrefix,\r\n        loading: false\r\n      });\r\n      \r\n      // Set current selection based on existing override or detect from supplier code\r\n      const statusResponse = await fetch(`/api/orders/${selectedOrder.id}/override-status`);\r\n      if (statusResponse.ok) {\r\n        const status = await statusResponse.json();\r\n        setOverrideStatus(status);\r\n        \r\n        if (status.appliedOverride) {\r\n          setSelectedOverride(`${status.appliedOverride.depth} - ${status.appliedOverride.firmness}`);\r\n        }\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('Error checking override status:', error);\r\n      setOverrideData(prev => ({ ...prev, loading: false }));\r\n    }\r\n  };\r\n\r\n  const applyOverride = async () => {\r\n  if (!selectedOverride) return;\r\n  \r\n  // Debug logging\r\n  console.log('Selected override:', selectedOverride);\r\n  console.log('SKU prefix:', overrideData.skuPrefix);\r\n  \r\n  const parts = selectedOverride.split(' - ');\r\n  if (parts.length !== 2) {\r\n    return;\r\n  }\r\n  \r\n  const depth = parts[0];\r\n  const firmness = parts[1];\r\n  \r\n  console.log('Sending depth:', depth);\r\n  console.log('Sending firmness:', firmness);\r\n  \r\n  setApplying(true);\r\n  \r\n  try {\r\n    const response = await fetch(`/api/orders/${selectedOrder.id}/override-firmness`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        depth: depth,\r\n        firmness: firmness,\r\n        skuPrefix: overrideData.skuPrefix  // âœ… Send the detected prefix\r\n      })\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(errorData.error || 'Override failed');\r\n    }\r\n    \r\n    const result = await response.json();\r\n    \r\n    // Update the supplier code in the parent component\r\n    onSupplierCodeUpdate(result.newSupplierCode);\r\n    \r\n    // Update our local state\r\n    setOverrideStatus(prev => ({ \r\n      ...prev, \r\n      overrideApplied: true,\r\n      appliedOverride: { depth, firmness }\r\n    }));\r\n     \r\n  } catch (error) {\r\n    console.error('Error applying override:', error);\r\n\r\n  } finally {\r\n    setApplying(false);\r\n  }\r\n};\r\n\r\n  // Don't render if no order selected or not in edit mode\r\n  if (!selectedOrder || !editMode) return null;\r\n\r\n  // Loading state\r\n  if (overrideData.loading) {\r\n    return (\r\n      <div className=\"border rounded-lg p-4 bg-blue-50 mb-4\">\r\n        <div className=\"flex items-center gap-2 mb-2\">\r\n          <RefreshCw className=\"h-4 w-4 animate-spin text-blue-600\" />\r\n          <h3 className=\"font-semibold text-blue-900\">Loading Firmness Options...</h3>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n// Debug logging\r\nconsole.log('DEBUG - Order:', selectedOrder.orderNumber);\r\nconsole.log('DEBUG - supplierCode:', `\"${selectedOrder.supplierCode}\"`);\r\nconsole.log('DEBUG - supplierCode type:', typeof selectedOrder.supplierCode);\r\nconsole.log('DEBUG - overrideData.options:', overrideData.options);\r\nconsole.log('DEBUG - editMode:', editMode);\r\n\r\n// Show override interface if we have options\r\nif ((overrideData.options && overrideData.options.length > 0) || \r\n    (!selectedOrder.supplierCode || selectedOrder.supplierCode.trim() === '' || selectedOrder.supplierCode === '-')) {\r\n    return (\r\n      <div className=\"border rounded-lg p-4 bg-green-50 border-green-200 mb-4\">\r\n        <div className=\"flex items-center gap-2 mb-3\">\r\n          <div className=\"h-2 w-2 bg-green-500 rounded-full\"></div>\r\n          <h3 className=\"font-semibold text-green-900\">Firmness Override Available</h3>\r\n        </div>\r\n        \r\n        <div className=\"text-sm text-green-800 mb-3\">\r\n          Adjust firmness for <strong>{overrideData.mattressType}</strong> mattress. Current supplier code will be regenerated.\r\n        </div>\r\n        \r\n        <div className=\"space-y-3\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-green-900 mb-2\">\r\n              Select Depth & Firmness:\r\n            </label>\r\n            <select\r\n              value={selectedOverride}\r\n              onChange={(e) => setSelectedOverride(e.target.value)}\r\n              className=\"w-full p-3 border border-green-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white\"\r\n            >\r\n              <option value=\"\">-- Select depth and firmness --</option>\r\n              {overrideData.options.map((option) => (\r\n                <option key={option.value} value={option.label}>\r\n                  {option.label}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          \r\n          <div className=\"flex justify-end gap-2\">\r\n            <button\r\n              onClick={checkOverrideStatus}\r\n              className=\"px-3 py-2 text-sm border border-green-300 rounded text-green-700 hover:bg-green-100\"\r\n            >\r\n              Refresh Options\r\n            </button>\r\n            <button\r\n              onClick={applyOverride}\r\n              disabled={!selectedOverride || applying}\r\n              className={`px-4 py-2 text-sm rounded text-white font-medium ${\r\n                selectedOverride && !applying\r\n                  ? 'bg-green-600 hover:bg-green-700' \r\n                  : 'bg-gray-400 cursor-not-allowed'\r\n              }`}\r\n            >\r\n              {applying ? 'Applying...' : 'Apply Override'}\r\n            </button>\r\n          </div>\r\n          \r\n          {overrideStatus?.appliedOverride && (\r\n            <div className=\"text-xs text-green-600 mt-2\">\r\n              Last applied: {overrideStatus.appliedOverride.depth} - {overrideStatus.appliedOverride.firmness}\r\n              {overrideStatus.overrideTimestamp && (\r\n                <span className=\"ml-2\">({new Date(overrideStatus.overrideTimestamp).toLocaleString()})</span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst OrderProcessor = () => {\r\n  const [orders, setOrders] = useState([]);\r\n  const [selectedOrder, setSelectedOrder] = useState(null);\r\n  const [editMode, setEditMode] = useState(false);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  \r\n  // New state for diagram upload\r\n  const [uploadingDiagram, setUploadingDiagram] = useState(false);\r\n  const [selectedFile, setSelectedFile] = useState(null);\r\n  const [storageStatus, setStorageStatus] = useState(null);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n\r\n  const getDiagramImageUrl = (diagramNumber) => {\r\n    if (!diagramNumber) return null;\r\n    return `/images/diagrams/Shape_${diagramNumber}_Caravan_Mattress_Measuring_Diagram.jpg`;\r\n  };\r\n\r\n  // Check storage status\r\n  const checkStorageStatus = async () => {\r\n    try {\r\n      const response = await fetch('/api/diagrams/storage-status');\r\n      if (response.ok) {\r\n        const status = await response.json();\r\n        setStorageStatus(status);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to check storage status:', error);\r\n    }\r\n  };\r\n\r\n  // Handle file selection\r\n  const handleFileSelect = (event) => {\r\n    const file = event.target.files[0];\r\n    if (file) {\r\n      // Validate file size and type on frontend\r\n      const maxSize = 5 * 1024 * 1024; // 5MB\r\n      const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];\r\n      \r\n      if (file.size > maxSize) {\r\n        alert('File too large. Maximum size is 5MB.');\r\n        return;\r\n      }\r\n      \r\n      if (!allowedTypes.includes(file.type)) {\r\n        alert('Invalid file type. Only JPG, PNG, and PDF files are allowed.');\r\n        return;\r\n      }\r\n      \r\n      setSelectedFile(file);\r\n    }\r\n  };\r\n\r\n  // Upload diagram\r\n  const handleDiagramUpload = async () => {\r\n    if (!selectedFile) return;\r\n    \r\n    setUploadingDiagram(true);\r\n    setUploadProgress(0);\r\n    \r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('diagram', selectedFile);\r\n      \r\n      const response = await fetch(`/api/diagrams/${selectedOrder.id}/upload-diagram`, {\r\n        method: 'POST',\r\n        body: formData\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Upload failed');\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      // Update selected order with new diagram info\r\n      setSelectedOrder(prev => ({\r\n        ...prev,\r\n        has_custom_diagram: true,\r\n        custom_diagram_url: result.url,\r\n        custom_diagram_filename: result.filename\r\n      }));\r\n      \r\n      // Update orders list\r\n      setOrders(orders.map(order => \r\n        order.id === selectedOrder.id \r\n          ? { ...order, has_custom_diagram: true, custom_diagram_url: result.url }\r\n          : order\r\n      ));\r\n      \r\n      // Update storage status\r\n      if (result.storage) {\r\n        setStorageStatus(result.storage);\r\n      }\r\n      \r\n      setSelectedFile(null);\r\n      alert('Diagram uploaded successfully!');\r\n      \r\n    } catch (error) {\r\n      console.error('Upload error:', error);\r\n      alert(`Upload failed: ${error.message}`);\r\n    } finally {\r\n      setUploadingDiagram(false);\r\n      setUploadProgress(0);\r\n    }\r\n  };\r\n\r\n  // Remove diagram\r\n  const handleDiagramRemove = async () => {\r\n    if (!confirm('Are you sure you want to remove this custom diagram?')) {\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const response = await fetch(`/api/diagrams/${selectedOrder.id}/diagram`, {\r\n        method: 'DELETE'\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error('Failed to remove diagram');\r\n      }\r\n      \r\n      // Update selected order\r\n      setSelectedOrder(prev => ({\r\n        ...prev,\r\n        has_custom_diagram: false,\r\n        custom_diagram_url: null,\r\n        custom_diagram_filename: null\r\n      }));\r\n      \r\n      // Update orders list\r\n      setOrders(orders.map(order => \r\n        order.id === selectedOrder.id \r\n          ? { ...order, has_custom_diagram: false, custom_diagram_url: null }\r\n          : order\r\n      ));\r\n      \r\n      alert('Diagram removed successfully!');\r\n      \r\n    } catch (error) {\r\n      console.error('Remove error:', error);\r\n      alert(`Failed to remove diagram: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const transformApiOrder = (apiOrder) => {\r\n    // ADD THIS DEBUG BLOCK RIGHT HERE - AT THE START OF THE FUNCTION\r\n    console.group('ðŸ” Coolplus Debug - Order:', apiOrder.order_number);\r\n    console.log('Full apiOrder object:', apiOrder);\r\n    console.log('line_items exists?', !!apiOrder.line_items);\r\n    console.log('line_items content:', apiOrder.line_items);\r\n    if (apiOrder.line_items && apiOrder.line_items[0]) {\r\n      console.log('First line item:', apiOrder.line_items[0]);\r\n      console.log('Specification field:', apiOrder.line_items[0].specification);\r\n      console.log('Type of specification:', typeof apiOrder.line_items[0].specification);\r\n    }\r\n    console.log('order_data:', apiOrder.order_data);\r\n    console.log('order_data.supplierSpecification:', apiOrder.order_data?.supplierSpecification);\r\n    console.groupEnd();\r\n    // END OF DEBUG BLOCK\r\n\r\n    const orderData = apiOrder.order_data || {};\r\n      \r\n    let diagramNumber = null;\r\n    const lineItems = apiOrder.order_data?.order_data?.line_items;\r\n    if (lineItems && lineItems[0] && lineItems[0].properties) {\r\n      const diagramProperty = lineItems[0].properties.find(prop => prop.name === 'Diagram Number');\r\n      diagramNumber = diagramProperty ? diagramProperty.value : null;\r\n    }\r\n\r\n    let linkAttachment = 'One Piece Mattress No Link Required';\r\n    let deliveryOption = 'Rolled and Boxed';\r\n    \r\n    if (lineItems && lineItems[0] && lineItems[0].variant_title) {\r\n      const variantTitle = lineItems[0].variant_title;\r\n      const productTitle = lineItems[0].title || lineItems[0].name || '';\r\n      \r\n      if (variantTitle.includes('Leave Bolster Loose')) {\r\n        linkAttachment = 'Leave Bolster Loose';\r\n      } else if (variantTitle.includes('Leave Sections Loose')) {\r\n        linkAttachment = 'Leave Sections Loose';\r\n      } else if (variantTitle.includes('Fabric Link')) {\r\n        linkAttachment = 'Fabric Link (+Â£40)';\r\n      } else if (variantTitle.includes('Zip-Link')) {\r\n        linkAttachment = 'Zip-Link (+Â£40)';\r\n      } else {\r\n        if (productTitle.toLowerCase().includes('bolster')) {\r\n          linkAttachment = 'Leave Bolster Loose';\r\n        } else if (productTitle.toLowerCase().includes('section')) {\r\n          linkAttachment = 'Leave Sections Loose';\r\n        } else {\r\n          linkAttachment = 'One Piece Mattress No Link Required';\r\n        }\r\n      }\r\n    }\r\n\r\n    const measurements = apiOrder.order_data?.order_data?.extracted_measurements?.[0]?.measurements || {};\r\n    \r\n    const properties = {};\r\n    const dimensions = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];\r\n    \r\n    dimensions.forEach(dim => {\r\n      // First try to get from saved database columns\r\n      const savedDimension = apiOrder[`dimension_${dim.toLowerCase()}`];\r\n      if (savedDimension) {\r\n        properties[`Dimension ${dim}`] = savedDimension;\r\n      } else {\r\n        // Fall back to original measurements extraction\r\n        const measurement = measurements[dim];\r\n        if (measurement) {\r\n          if (typeof measurement === 'object' && 'value' in measurement) {\r\n            const displayValue = measurement.unit \r\n              ? `${measurement.value} ${measurement.unit}`\r\n              : measurement.value;\r\n            properties[`Dimension ${dim}`] = displayValue;\r\n          } else {\r\n            properties[`Dimension ${dim}`] = String(measurement);\r\n          }\r\n        } else {\r\n          properties[`Dimension ${dim}`] = '';\r\n        }\r\n      }\r\n    });\r\n\r\n    // ADD THIS DEBUG LINE RIGHT BEFORE THE RETURN\r\n    const finalSupplierCode = apiOrder.line_items?.[0]?.specification || orderData.supplierSpecification || '';\r\n    console.log('ðŸ“Œ Final supplierCode being set:', finalSupplierCode);\r\n\r\n    return {\r\n      id: apiOrder.id.toString(),\r\n      orderNumber: apiOrder.order_number || 'Unknown',\r\n      customer: {\r\n        name: apiOrder.customer_name || 'Unknown Customer',\r\n        email: apiOrder.customer_email || ''\r\n      },\r\n      orderDate: apiOrder.created_date ? new Date(apiOrder.created_date).toISOString().split('T')[0] : '',\r\n      status: apiOrder.processing_status === 'received' ? 'pending_review' : 'ready_to_send',\r\n      emailSent: apiOrder.email_sent || false,\r\n      lineItems: [{\r\n        sku: orderData.sku || lineItems?.[0]?.sku || 'Unknown SKU',\r\n        productTitle: lineItems?.[0]?.title || 'Unknown Product',\r\n        quantity: 1,\r\n        properties: properties\r\n      }],\r\n      supplierCode: apiOrder.supplier_code || apiOrder.line_items?.[0]?.specification || orderData.supplierSpecification || '',\r\n      shapeNumber: orderData.shapeNumber || '',\r\n      diagramNumber: diagramNumber,\r\n      shapeDiagramUrl: getDiagramImageUrl(diagramNumber),\r\n      linkAttachment: apiOrder.link_attachment || linkAttachment,\r\n      deliveryOption: apiOrder.delivery_option || deliveryOption,\r\n      radiusTopCorner: apiOrder.radius_top_corner || '',\r\n      radiusBottomCorner: apiOrder.radius_bottom_corner || '',\r\n      finishedSizeMax: apiOrder.finished_size_max || '',\r\n      totalPrice: apiOrder.total_price,\r\n      supplierName: apiOrder.supplier_name || orderData.supplierName,\r\n      rawMeasurements: measurements,\r\n      notes: apiOrder.notes || '',\r\n      mattressLabel: apiOrder.mattress_label || 'CaravanMattresses',\r\n      // Add custom diagram fields\r\n      has_custom_diagram: apiOrder.has_custom_diagram || false,\r\n      custom_diagram_url: apiOrder.custom_diagram_url || null,\r\n      custom_diagram_filename: apiOrder.custom_diagram_url ? apiOrder.custom_diagram_url.split('/').pop() : null\r\n    };\r\n  };\r\n\r\n  const fetchOrders = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const response = await fetch('/api/orders');\r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch orders: ${response.status}`);\r\n      }\r\n      \r\n      const apiResponse = await response.json();\r\n\r\n      // ADD THIS DEBUG BLOCK HERE\r\n      console.group('ðŸŒ API Response Debug');\r\n      console.log('Full API response:', apiResponse);\r\n      console.log('Number of orders:', apiResponse.orders?.length);\r\n      if (apiResponse.orders && apiResponse.orders[0]) {\r\n        console.log('First order from API:', apiResponse.orders[0]);\r\n        console.log('First order line_items:', apiResponse.orders[0].line_items);\r\n      }\r\n      console.groupEnd();\r\n      // END OF DEBUG BLOCK\r\n\r\n      const ordersArray = apiResponse.orders || [];\r\n      const transformedOrders = ordersArray.map(transformApiOrder);\r\n      setOrders(transformedOrders);\r\n      \r\n    } catch (err) {\r\n      console.error('Error fetching orders:', err);\r\n      setError(err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchOrders();\r\n    checkStorageStatus();\r\n    const interval = setInterval(() => {\r\n      if (!editMode) {\r\n        fetchOrders();\r\n      }\r\n    }, 30000);\r\n    return () => clearInterval(interval);\r\n  }, [editMode]);\r\n\r\n  const handleOrderSelect = (order) => {\r\n    if (selectedOrder?.id === order.id) {\r\n      setSelectedOrder(null);\r\n      setEditMode(false);\r\n    } else {\r\n      setSelectedOrder({ ...order });\r\n      setEditMode(false);\r\n      setSelectedFile(null); // Clear any selected file\r\n    }\r\n  };\r\n\r\n  const handleEdit = () => setEditMode(true);\r\n  \r\n  const handleSave = async () => {\r\n    try {\r\n      const response = await fetch(`/api/orders/${selectedOrder.id}`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          processing_status: selectedOrder.status === 'ready_to_send' ? 'processed' : 'received',\r\n          notes: selectedOrder.notes,\r\n          mattress_label: selectedOrder.mattressLabel,\r\n          order_number: selectedOrder.orderNumber,\r\n          customer_name: selectedOrder.customer.name,\r\n          customer_email: selectedOrder.customer.email,\r\n          order_date: selectedOrder.orderDate,\r\n          supplier_code: selectedOrder.supplierCode,\r\n          product_sku: selectedOrder.lineItems[0]?.sku,\r\n          quantity: selectedOrder.lineItems[0]?.quantity,\r\n          dimension_a: selectedOrder.lineItems[0]?.properties['Dimension A'],\r\n          dimension_b: selectedOrder.lineItems[0]?.properties['Dimension B'],\r\n          dimension_c: selectedOrder.lineItems[0]?.properties['Dimension C'],\r\n          dimension_d: selectedOrder.lineItems[0]?.properties['Dimension D'],\r\n          dimension_e: selectedOrder.lineItems[0]?.properties['Dimension E'],\r\n          dimension_f: selectedOrder.lineItems[0]?.properties['Dimension F'],\r\n          dimension_g: selectedOrder.lineItems[0]?.properties['Dimension G'],\r\n          radius_top_corner: selectedOrder.radiusTopCorner,\r\n          radius_bottom_corner: selectedOrder.radiusBottomCorner,\r\n          finished_size_max: selectedOrder.finishedSizeMax,\r\n          link_attachment: selectedOrder.linkAttachment,\r\n          delivery_option: selectedOrder.deliveryOption,\r\n          measurements: selectedOrder.lineItems[0]?.properties || {}\r\n        })\r\n      });\r\n\r\n      const result = await response.json();\r\n      console.log('Save response:', result);\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Server error: ${response.status}`);\r\n      }\r\n\r\n      setOrders(orders.map(order => \r\n        order.id === selectedOrder.id ? selectedOrder : order\r\n      ));\r\n      \r\n      setEditMode(false);\r\n      \r\n    } catch (err) {\r\n      console.error('Error saving order:', err);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    const originalOrder = orders.find(order => order.id === selectedOrder.id);\r\n    setSelectedOrder({ ...originalOrder });\r\n    setEditMode(false);\r\n    setSelectedFile(null); // Clear any selected file\r\n  };\r\n\r\n  const updateOrderField = (field, value) => {\r\n    setSelectedOrder(prev => ({ ...prev, [field]: value }));\r\n  };\r\n\r\n  const updateCustomerField = (field, value) => {\r\n    setSelectedOrder(prev => ({\r\n      ...prev,\r\n      customer: { ...prev.customer, [field]: value }\r\n    }));\r\n  };\r\n\r\n  const updateMeasurement = (dimension, value) => {\r\n    setSelectedOrder(prev => ({\r\n      ...prev,\r\n      lineItems: prev.lineItems.map(item => ({\r\n        ...item,\r\n        properties: { ...item.properties, [dimension]: value }\r\n      }))\r\n    }));\r\n  };\r\n\r\n  const updateAdditionalField = (field, value) => {\r\n    setSelectedOrder(prev => ({ ...prev, [field]: value }));\r\n  };\r\n\r\n  const generatePDF = async () => {\r\n    try {\r\n      console.log('Generating PDF for order:', selectedOrder.orderNumber);\r\n      \r\n      const response = await fetch('/api/pdf/generate', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          order: selectedOrder\r\n        })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to generate PDF');\r\n      }\r\n\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `Order_${selectedOrder.orderNumber}_${selectedOrder.customer.name.replace(/\\s+/g, '_')}.pdf`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      window.URL.revokeObjectURL(url);\r\n      \r\n    } catch (err) {\r\n      console.error('Error generating PDF:', err);\r\n      alert('Failed to generate PDF');\r\n    }\r\n  };\r\n\r\n  const getSupplierEmail = (supplierName) => {\r\n    const supplierEmails = {\r\n      'Southern Production': 'mbm@southernfoam.co.uk',\r\n      'Mattressshire Production': 'mattressshire.wmltd@gmail.com'\r\n    };\r\n    \r\n    return supplierEmails[supplierName] || 'angelo@mybespokemattress.com';\r\n  };\r\n\r\n  const openZohoMail = () => {\r\n    console.log('Supplier name:', selectedOrder.supplierName);\r\n    const supplierEmail = getSupplierEmail(selectedOrder.supplierName);\r\n    const subject = `Purchase Order ${selectedOrder.orderNumber} - ${selectedOrder.customer.name}`;\r\n    \r\n    // Official Zoho compose URL\r\n    window.open('https://mail.zoho.eu/zm/#compose', '_blank');\r\n    \r\n    // Create alert with email details to copy\r\n    setTimeout(() => {\r\n      alert(`Zoho Mail opened. Please copy these details:\\n\\nTO: ${supplierEmail}\\nSUBJECT: ${subject}\\n\\nThen attach the downloaded PDF and send.`);\r\n    }, 1000);\r\n  };\r\n\r\n  const markOrderAsSent = async () => {\r\n    const response = await fetch(`/api/orders/${selectedOrder.id}`, {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ email_sent: true })\r\n    });\r\n    \r\n    if (response.ok) {\r\n      setOrders(orders.map(order => \r\n        order.id === selectedOrder.id ? { ...order, emailSent: true } : order\r\n      ));\r\n      setSelectedOrder(prev => ({ ...prev, emailSent: true }));\r\n    } else {\r\n      alert(`API Error: ${response.status}`);\r\n    }\r\n  };\r\n\r\n  const filteredOrders = orders.filter(order =>\r\n    order.orderNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    order.customer.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\r\n          <p className=\"mt-2 text-slate-600\">Loading orders...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-red-600 mb-4\">Error loading orders: {error}</p>\r\n          <button \r\n            onClick={fetchOrders}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50\">\r\n      <div className=\"bg-white border-b shadow-sm\">\r\n        <div className=\"max-w-7xl mx-auto px-6 py-4\">\r\n          <div className=\"flex justify-between items-center\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-slate-900\">\r\n                Bespoke Mattress Order Processor\r\n              </h1>\r\n              <p className=\"text-slate-600 mt-1\">\r\n                Review and process Shopify orders before sending to suppliers\r\n              </p>\r\n              {storageStatus && storageStatus.percentage > 80 && (\r\n                <div className=\"mt-2 flex items-center gap-2 text-amber-600\">\r\n                  <AlertTriangle size={16} />\r\n                  <span className=\"text-sm\">\r\n                    Storage {storageStatus.percentage}% full ({storageStatus.used}/{storageStatus.limit})\r\n                  </span>\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"text-sm text-slate-500\">\r\n              {orders.length} orders loaded\r\n              <button \r\n                onClick={fetchOrders}\r\n                className=\"ml-2 px-3 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200\"\r\n              >\r\n                Refresh\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          \r\n          <div className=\"lg:col-span-1\">\r\n            <div className=\"bg-white rounded-lg shadow border\">\r\n              <div className=\"p-4 border-b bg-slate-50\">\r\n                <h2 className=\"text-lg font-semibold mb-3\">Orders Queue</h2>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search orders...\"\r\n                  className=\"w-full px-3 py-2 border rounded-lg\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                />\r\n              </div>\r\n              \r\n              <div className=\"max-h-96 overflow-y-auto\">\r\n                {filteredOrders.length === 0 ? (\r\n                  <div className=\"p-4 text-center text-slate-500\">\r\n                    {searchTerm ? 'No orders match your search' : 'No orders found'}\r\n                  </div>\r\n                ) : (\r\n                  filteredOrders.map((order) => (\r\n                    <div\r\n                      key={order.id}\r\n                      className={`p-4 border-b cursor-pointer hover:bg-slate-50 ${\r\n                        selectedOrder?.id === order.id ? 'bg-blue-50' : ''\r\n                      }`}\r\n                      onClick={() => handleOrderSelect(order)}\r\n                    >\r\n                      <div className=\"flex justify-between items-start\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center gap-2 mb-1\">\r\n                            <span className=\"font-semibold text-sm\">{order.orderNumber}</span>\r\n                            {order.diagramNumber && (\r\n                              <span className=\"px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-700\">\r\n                                Shape {order.diagramNumber}\r\n                              </span>\r\n                            )}\r\n                            {order.has_custom_diagram && (\r\n                              <span className=\"px-1.5 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-700\">\r\n                                Custom\r\n                              </span>\r\n                            )}\r\n                            {order.notes && (\r\n                              <span className=\"px-1.5 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-700\">\r\n                                Notes\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"text-slate-600 text-sm\">{order.customer.name}</div>\r\n                          <div className=\"text-slate-500 text-xs\">{order.orderDate}</div>\r\n                          {order.supplierName && (\r\n                            <div className=\"text-slate-500 text-xs mt-1\">â†’ {order.supplierName}</div>\r\n                          )}\r\n\r\n                        </div>\r\n                        <div>\r\n                          <span className={`px-2 py-1 rounded text-xs ${\r\n                            order.emailSent \r\n                                ? 'bg-green-100 text-green-800'\r\n                                : order.status === 'ready_to_send' \r\n                                ? 'bg-yellow-100 text-yellow-800'\r\n                                : 'bg-grey-100 text-grey-800'\r\n                            }`}>\r\n                            {order.emailSent ? 'Sent' : (order.status === 'ready_to_send' ? 'Ready' : 'Review')}\r\n                            </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"lg:col-span-2\">\r\n            {selectedOrder ? (\r\n              <div className=\"bg-white rounded-lg shadow border\">\r\n                <div className=\"p-4 border-b bg-slate-50 flex justify-between items-center\">\r\n                  <div>\r\n                    <h2 className=\"text-lg font-semibold\">Order Details</h2>\r\n                    <p className=\"text-sm text-slate-600\">{selectedOrder.orderNumber}</p>\r\n                  </div>\r\n                  <div className=\"flex gap-2\">\r\n                    {!editMode ? (\r\n                      <>\r\n                        <button\r\n                          onClick={handleEdit}\r\n                          className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center gap-2\"\r\n                        >\r\n                          <Edit3 size={16} />\r\n                          Edit\r\n                        </button>\r\n                        <button\r\n                          onClick={generatePDF}\r\n                          className=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2\"\r\n                        >\r\n                          <Download size={16} />\r\n                          Download PDF\r\n                        </button>\r\n                        <button\r\n                        onClick={async () => {\r\n                            try {\r\n                                // 1. Download PDF locally\r\n                                await generatePDF();\r\n                                \r\n                                // 2. Send test email automatically\r\n                                const emailResponse = await fetch('/api/email/send', {\r\n                                    method: 'POST',\r\n                                    headers: { 'Content-Type': 'application/json' },\r\n                                    body: JSON.stringify({\r\n                                        to: 'angelo@mybespokemattress.com',  // Your test email\r\n                                        subject: `Purchase Order ${selectedOrder.orderNumber} - ${selectedOrder.customer.name}`,\r\n                                        body: `\r\n                                            <h2>New Purchase Order</h2>\r\n                                            <p>Dear Supplier,</p>\r\n                                            <p>Please find attached a new purchase order:</p>\r\n                                            <ul>\r\n                                                <li><strong>Order Number:</strong> ${selectedOrder.orderNumber}</li>\r\n                                                <li><strong>Customer:</strong> ${selectedOrder.customer.name}</li>\r\n                                            </ul>\r\n                                            <p>Kind regards,<br>My Bespoke Order Ltd</p>\r\n                                        `,\r\n                                        orderId: selectedOrder.id,\r\n                                        orderData: selectedOrder  // ADD THIS LINE\r\n                                    })\r\n                                });\r\n\r\n                                if (!emailResponse.ok) throw new Error('Email sending failed');\r\n                                \r\n                                // 3. Mark as sent only if successful\r\n                                await markOrderAsSent();\r\n                                alert('PDF downloaded and email sent successfully!');\r\n                                \r\n                            } catch (error) {\r\n                                console.error('Error:', error);\r\n                                alert(`Failed: ${error.message}`);\r\n                            }\r\n                        }}\r\n                        className=\"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 flex items-center gap-2\"\r\n                        >\r\n                          <Mail size={16} />\r\n                          <Download size={14} />\r\n                          Download and Email\r\n                        </button>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <button\r\n                          onClick={handleSave}\r\n                          className=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2\"\r\n                        >\r\n                          <Save size={16} />\r\n                          Save\r\n                        </button>\r\n                        <button\r\n                          onClick={handleCancel}\r\n                          className=\"px-4 py-2 bg-slate-500 text-white rounded hover:bg-slate-600 flex items-center gap-2\"\r\n                        >\r\n                          <X size={16} />\r\n                          Cancel\r\n                        </button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"p-6 space-y-6\">\r\n                  \r\n                  <div className=\"border rounded-lg p-4\">\r\n                    <h3 className=\"font-semibold mb-3\">Customer Notes</h3>\r\n                    <textarea\r\n                      value={selectedOrder.notes}\r\n                      onChange={(e) => updateOrderField('notes', e.target.value)}\r\n                      disabled={!editMode}\r\n                      placeholder=\"No customer notes provided\"\r\n                      rows={3}\r\n                      className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                    />\r\n                  </div>\r\n              \r\n                  <div className=\"border rounded-lg p-4\">\r\n                    <h3 className=\"font-semibold mb-3\">Order Information</h3>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <label className=\"block text-sm text-slate-600 mb-1\">Order Number</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={selectedOrder.orderNumber}\r\n                          onChange={(e) => updateOrderField('orderNumber', e.target.value)}\r\n                          disabled={!editMode}\r\n                          className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-sm text-slate-600 mb-1\">Order Date</label>\r\n                        <input\r\n                          type=\"date\"\r\n                          value={selectedOrder.orderDate}\r\n                          onChange={(e) => updateOrderField('orderDate', e.target.value)}\r\n                          disabled={!editMode}\r\n                          className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"border rounded-lg p-4\">\r\n                    <h3 className=\"font-semibold mb-3\">Customer Information</h3>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <label className=\"block text-sm text-slate-600 mb-1\">Customer Name</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={selectedOrder.customer.name}\r\n                          onChange={(e) => updateCustomerField('name', e.target.value)}\r\n                          disabled={!editMode}\r\n                          className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-sm text-slate-600 mb-1\">Email</label>\r\n                        <input\r\n                          type=\"email\"\r\n                          value={selectedOrder.customer.email}\r\n                          onChange={(e) => updateCustomerField('email', e.target.value)}\r\n                          disabled={!editMode}\r\n                          className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"border rounded-lg p-4\">\r\n                    <h3 className=\"font-semibold mb-3\">Product Information</h3>\r\n                    \r\n                    {/* Supplier Code - Full width, multi-line - NOW FIRST */}\r\n                    <div className=\"mb-4\">\r\n                      <label className=\"block text-sm text-slate-600 mb-1\">Supplier Code</label>\r\n                      <textarea\r\n                        value={selectedOrder.supplierCode}\r\n                        onChange={(e) => updateOrderField('supplierCode', e.target.value)}\r\n                        disabled={!editMode}\r\n                        rows={2}\r\n                        className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100 font-mono text-sm resize-none\"\r\n                      />\r\n                    </div>\r\n                    \r\n                    {/* Firmness Override Section - NOW SECOND */}\r\n                    <FirmnessOverrideSection \r\n                      selectedOrder={selectedOrder}\r\n                      onSupplierCodeUpdate={(newCode) => {\r\n                        setSelectedOrder(prev => ({ ...prev, supplierCode: newCode }));\r\n                        setOrders(orders.map(order => \r\n                          order.id === selectedOrder.id \r\n                            ? { ...order, supplierCode: newCode } \r\n                            : order\r\n                        ));\r\n                      }}\r\n                      editMode={editMode}\r\n                    />\r\n                    \r\n                    {/* SKU and Quantity on same line below */}\r\n                    <div className=\"flex gap-4\">\r\n                      <div className=\"flex-1\">\r\n                        <label className=\"block text-sm text-slate-600 mb-1\">Product SKU</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={selectedOrder.lineItems[0]?.sku || 'Unknown SKU'}\r\n                          disabled\r\n                          className=\"w-full px-3 py-2 border rounded bg-slate-100 text-sm\"\r\n                        />\r\n                      </div>\r\n                      \r\n                      <div className=\"w-20\">\r\n                        <label className=\"block text-sm text-slate-600 mb-1\">Qty</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={selectedOrder.lineItems[0]?.quantity || 1}\r\n                          onChange={(e) => {\r\n                            const newQuantity = parseInt(e.target.value) || 1;\r\n                            setSelectedOrder(prev => ({\r\n                              ...prev,\r\n                              lineItems: prev.lineItems.map((item, index) => \r\n                                index === 0 ? { ...item, quantity: newQuantity } : item\r\n                              )\r\n                            }));\r\n                          }}\r\n                          disabled={!editMode}\r\n                          className=\"w-full px-2 py-2 border rounded disabled:bg-slate-100 text-center\"\r\n                          min=\"1\"\r\n                          max=\"99\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {selectedOrder.supplierName && (\r\n                      <div className=\"mt-3 text-sm text-slate-600\">\r\n                        Assigned to: <span className=\"font-medium\">{selectedOrder.supplierName}</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"border rounded-lg p-4\">\r\n                    <h3 className=\"font-semibold mb-3\">Measurements & Shape Diagram</h3>\r\n                    \r\n                    <div className=\"grid grid-cols-2 gap-6\">\r\n                      <div>\r\n                        <h4 className=\"text-sm text-slate-600 mb-3\">Dimensions</h4>\r\n                        <div className=\"space-y-2\">\r\n                          {['Dimension A', 'Dimension B', 'Dimension C', 'Dimension D', 'Dimension E', 'Dimension F', 'Dimension G'].map((dimension) => {\r\n                            const value = selectedOrder.lineItems[0]?.properties[dimension] || '';\r\n                            const hasValue = value && value !== '';\r\n                            \r\n                            return (\r\n                              <div key={dimension} className=\"flex items-center gap-2\">\r\n                                <label className=\"w-6 text-sm font-medium text-center\">\r\n                                  {dimension.replace('Dimension ', '')}\r\n                                </label>\r\n                                <input\r\n                                  type=\"text\"\r\n                                  value={value}\r\n                                  onChange={(e) => updateMeasurement(dimension, e.target.value)}\r\n                                  disabled={!editMode}\r\n                                  placeholder=\"Not provided\"\r\n                                  className={`flex-1 px-3 py-2 border rounded disabled:bg-slate-100 font-mono ${\r\n                                    hasValue ? 'text-slate-900' : 'text-slate-400'\r\n                                  }`}\r\n                                />\r\n                                {hasValue && !editMode && (\r\n                                  <span className=\"text-xs text-green-600\">âœ“</span>\r\n                                )}\r\n                              </div>\r\n                            );\r\n                          })}\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 pt-4 border-t\">\r\n                          <h4 className=\"text-sm text-slate-600 mb-3\">Additional Specifications</h4>\r\n                          <div className=\"space-y-2\">\r\n                            <div>\r\n                              <label className=\"block text-sm text-slate-600 mb-1\">Radius of Top Corner</label>\r\n                              <input\r\n                                type=\"text\"\r\n                                value={selectedOrder.radiusTopCorner || ''}\r\n                                onChange={(e) => updateAdditionalField('radiusTopCorner', e.target.value)}\r\n                                disabled={!editMode}\r\n                                placeholder=\"Enter radius\"\r\n                                className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                              />\r\n                            </div>\r\n                            <div>\r\n                              <label className=\"block text-sm text-slate-600 mb-1\">Radius of Bottom Corner</label>\r\n                              <input\r\n                                type=\"text\"\r\n                                value={selectedOrder.radiusBottomCorner || ''}\r\n                                onChange={(e) => updateAdditionalField('radiusBottomCorner', e.target.value)}\r\n                                disabled={!editMode}\r\n                                placeholder=\"Enter radius\"\r\n                                className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                              />\r\n                            </div>\r\n                            <div>\r\n                              <label className=\"block text-sm text-slate-600 mb-1\">Finished Size Must Not Exceed</label>\r\n                              <input\r\n                                type=\"text\"\r\n                                value={selectedOrder.finishedSizeMax || ''}\r\n                                onChange={(e) => updateAdditionalField('finishedSizeMax', e.target.value)}\r\n                                disabled={!editMode}\r\n                                placeholder=\"Enter maximum size\"\r\n                                className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <h4 className=\"text-sm text-slate-600 mb-3\">\r\n                          Shape Diagram\r\n                          {selectedOrder.diagramNumber && (\r\n                            <span className=\"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium\">\r\n                              Shape {selectedOrder.diagramNumber}\r\n                            </span>\r\n                          )}\r\n                          {selectedOrder.has_custom_diagram && (\r\n                            <span className=\"ml-2 px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium\">\r\n                              Custom Diagram\r\n                            </span>\r\n                          )}\r\n                        </h4>\r\n                        \r\n                        <div className=\"border rounded bg-slate-50\" style={{height: '400px'}}>\r\n                          {selectedOrder.has_custom_diagram && selectedOrder.custom_diagram_url ? (\r\n                            <div className=\"w-full h-full\">\r\n                              <img \r\n                                src={selectedOrder.custom_diagram_url} \r\n                                alt={`Custom diagram for order ${selectedOrder.orderNumber}`}\r\n                                className=\"w-full h-full object-contain\"\r\n                                onError={(e) => {\r\n                                  console.error('Custom diagram failed to load:', selectedOrder.custom_diagram_url);\r\n                                  e.target.style.display = 'none';\r\n                                  e.target.nextSibling.style.display = 'flex';\r\n                                }}\r\n                              />\r\n                              <div className=\"w-full h-full flex-col items-center justify-center text-slate-400 hidden\">\r\n                                <div className=\"text-sm mb-1\">Custom diagram failed to load</div>\r\n                                <div className=\"text-xs\">{selectedOrder.custom_diagram_filename}</div>\r\n                              </div>\r\n                            </div>\r\n                          ) : selectedOrder.shapeDiagramUrl ? (\r\n                            <div className=\"w-full h-full\">\r\n                              <img \r\n                                src={selectedOrder.shapeDiagramUrl} \r\n                                alt={`Shape ${selectedOrder.diagramNumber} Measuring Diagram`}\r\n                                className=\"w-full h-full object-contain\"\r\n                                onError={(e) => {\r\n                                  console.error('Diagram failed to load:', selectedOrder.shapeDiagramUrl);\r\n                                  e.target.style.display = 'none';\r\n                                  e.target.nextSibling.style.display = 'flex';\r\n                                }}\r\n                              />\r\n                              <div className=\"w-full h-full flex-col items-center justify-center text-slate-400 hidden\">\r\n                                <div className=\"text-sm mb-1\">Diagram failed to load</div>\r\n                                <div className=\"text-xs\">Shape #{selectedOrder.diagramNumber}</div>\r\n                                <div className=\"text-xs mt-2 text-slate-300\">\r\n                                  Check: /images/diagrams/Shape_{selectedOrder.diagramNumber}_Caravan_Mattress_Measuring_Diagram.jpg\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          ) : (\r\n                            <div className=\"w-full h-full flex flex-col items-center justify-center text-slate-400\">\r\n                              <div className=\"text-sm mb-1\">\r\n                                {selectedOrder.diagramNumber ? 'Diagram configured but not accessible' : 'No diagram specified'}\r\n                              </div>\r\n                              {selectedOrder.diagramNumber && (\r\n                                <div className=\"text-xs\">Shape #{selectedOrder.diagramNumber}</div>\r\n                              )}\r\n                              {!selectedOrder.diagramNumber && (\r\n                                <div className=\"text-xs mt-2 text-slate-300\">\r\n                                  Diagram number not found in order properties\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        \r\n                        {/* Enhanced Upload Interface */}\r\n                        {editMode && (\r\n                          <div className=\"mt-4 border-t pt-4\">\r\n                            <h5 className=\"text-sm font-medium mb-2\">Upload Custom Diagram</h5>\r\n                            \r\n                            {storageStatus && storageStatus.percentage > 80 && (\r\n                              <div className=\"mb-2 p-2 bg-yellow-100 text-yellow-800 rounded text-sm flex items-center gap-2\">\r\n                                <AlertTriangle size={16} />\r\n                                Warning: Storage is {storageStatus.percentage}% full ({storageStatus.used}/{storageStatus.limit})\r\n                              </div>\r\n                            )}\r\n                            \r\n                            <input \r\n                              type=\"file\" \r\n                              accept=\".jpg,.jpeg,.png,.pdf\"\r\n                              onChange={handleFileSelect}\r\n                              className=\"mb-2 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"\r\n                            />\r\n                            \r\n                            {selectedFile && (\r\n                              <div className=\"mb-2 p-2 bg-blue-50 rounded\">\r\n                                <p className=\"text-sm text-blue-800\">\r\n                                  Selected: {selectedFile.name} ({(selectedFile.size/1024/1024).toFixed(2)}MB)\r\n                                </p>\r\n                                <div className=\"flex gap-2 mt-2\">\r\n                                  <button \r\n                                    onClick={handleDiagramUpload} \r\n                                    disabled={uploadingDiagram}\r\n                                    className=\"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 disabled:opacity-50 flex items-center gap-1\"\r\n                                  >\r\n                                    <Upload size={14} />\r\n                                    {uploadingDiagram ? 'Uploading...' : 'Upload Diagram'}\r\n                                  </button>\r\n                                  <button \r\n                                    onClick={() => setSelectedFile(null)} \r\n                                    className=\"px-3 py-1 bg-slate-500 text-white rounded text-sm hover:bg-slate-600\"\r\n                                  >\r\n                                    Cancel\r\n                                  </button>\r\n                                </div>\r\n                              </div>\r\n                            )}\r\n                            \r\n                            {selectedOrder.has_custom_diagram && (\r\n                              <div className=\"mt-2 p-2 bg-green-50 rounded\">\r\n                                <p className=\"text-sm text-green-800 mb-2\">\r\n                                  Custom diagram uploaded: {selectedOrder.custom_diagram_filename}\r\n                                </p>\r\n                                <button \r\n                                  onClick={handleDiagramRemove} \r\n                                  className=\"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700 flex items-center gap-1\"\r\n                                >\r\n                                  <Trash2 size={14} />\r\n                                  Remove Custom Diagram\r\n                                </button>\r\n                              </div>\r\n                            )}\r\n                            \r\n                            <div className=\"mt-2 text-xs text-slate-500\">\r\n                              Supported formats: JPG, PNG, PDF. Maximum size: 5MB.\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"border rounded-lg p-4\">\r\n                    <h3 className=\"font-semibold mb-3\">Manufacturing Options</h3>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <label className=\"block text-sm text-slate-600 mb-1\">Link Attachment</label>\r\n                        <select\r\n                          value={selectedOrder.linkAttachment}\r\n                          onChange={(e) => updateOrderField('linkAttachment', e.target.value)}\r\n                          disabled={!editMode}\r\n                          className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                        >\r\n                          <option value=\"One Piece Construction\">One Piece Mattress No Link Required</option>\r\n                          <option value=\"Leave Sections Loose\">Leave Sections Loose</option>\r\n                          <option value=\"Leave Bolster Loose\">Leave Bolster Loose</option>\r\n                          <option value=\"Fabric Link (+Â£40)\">Fabric Link (+Â£40)</option>\r\n                          <option value=\"Zip-Link (+Â£40)\">Zip-Link (+Â£40)</option>\r\n                        </select>\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-sm text-slate-600 mb-1\">Delivery Option</label>\r\n                        <select\r\n                          value={selectedOrder.deliveryOption}\r\n                          onChange={(e) => updateOrderField('deliveryOption', e.target.value)}\r\n                          disabled={!editMode}\r\n                          className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                        >\r\n                          <option value=\"Rolled and Boxed\">Rolled and Boxed</option>\r\n                          <option value=\"Full Size Ready to Use\">Full Size Ready to Use</option>\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"border rounded-lg p-4\">\r\n                    <h3 className=\"font-semibold mb-3\">Mattress Label</h3>\r\n                    <select\r\n                      value={selectedOrder.mattressLabel}\r\n                      onChange={(e) => updateOrderField('mattressLabel', e.target.value)}\r\n                      disabled={!editMode}\r\n                      className=\"w-full px-3 py-2 border rounded disabled:bg-slate-100\"\r\n                    >\r\n                      <option value=\"CaravanMattresses\">Caravan Mattresses</option>\r\n                      <option value=\"MotorhomeMattresses\">Motorhome Mattresses</option>\r\n                      <option value=\"MyBespokeMattresses\">My Bespoke Mattresses</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"bg-white rounded-lg shadow border p-8 text-center\">\r\n                <div className=\"text-slate-400\">\r\n                  <svg className=\"mx-auto h-12 w-12 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                  </svg>\r\n                  <h3 className=\"text-lg font-medium text-slate-900 mb-2\">Select an Order</h3>\r\n                  <p className=\"text-slate-500\">Choose an order from the list to view and edit its details.</p>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OrderProcessor;"],"mappings":"sIAEA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,QAAQ,CAAEC,IAAI,CAAEC,KAAK,CAAEC,IAAI,CAAEC,CAAC,CAAEC,MAAM,CAAEC,MAAM,CAAEC,aAAa,CAAEC,SAAS,KAAQ,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAExG,KAAM,CAAAC,uBAAuB,CAAGC,IAAA,EAI1B,IAJ2B,CAC/BC,aAAa,CACbC,oBAAoB,CACpBC,QACF,CAAC,CAAAH,IAAA,CACC,KAAM,CAACI,YAAY,CAAEC,eAAe,CAAC,CAAGvB,QAAQ,CAAC,CAC/CwB,aAAa,CAAE,KAAK,CACpBC,OAAO,CAAE,EAAE,CACXC,YAAY,CAAE,IAAI,CAClBC,SAAS,CAAE,IAAI,CACfC,OAAO,CAAE,KACX,CAAC,CAAC,CAEF,KAAM,CAACC,gBAAgB,CAAEC,mBAAmB,CAAC,CAAG9B,QAAQ,CAAC,EAAE,CAAC,CAC5D,KAAM,CAAC+B,QAAQ,CAAEC,WAAW,CAAC,CAAGhC,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAACiC,cAAc,CAAEC,iBAAiB,CAAC,CAAGlC,QAAQ,CAAC,IAAI,CAAC,CAE1D;AACAC,SAAS,CAAC,IAAM,CACd,GAAIkB,aAAa,SAAbA,aAAa,WAAbA,aAAa,CAAEgB,EAAE,EAAId,QAAQ,CAAE,CACjCe,mBAAmB,CAAC,CAAC,CACvB,CAAC,IAAM,CACLb,eAAe,CAAC,CAAEC,aAAa,CAAE,KAAK,CAAEC,OAAO,CAAE,EAAE,CAAEC,YAAY,CAAE,IAAI,CAAEC,SAAS,CAAE,IAAI,CAAEC,OAAO,CAAE,KAAM,CAAC,CAAC,CAC3GM,iBAAiB,CAAC,IAAI,CAAC,CACzB,CACF,CAAC,CAAE,CAACf,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEgB,EAAE,CAAEd,QAAQ,CAAC,CAAC,CAEjC,KAAM,CAAAe,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACtC,GAAI,EAACjB,aAAa,SAAbA,aAAa,WAAbA,aAAa,CAAEgB,EAAE,EAAE,OAExBZ,eAAe,CAACc,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAET,OAAO,CAAE,IAAI,EAAG,CAAC,CAErD,GAAI,CAEF;AACA,KAAM,CAAAW,eAAe,CAAG,KAAM,CAAAC,KAAK,gBAAAC,MAAA,CAAgBtB,aAAa,CAACgB,EAAE,qBAAmB,CAAC,CACvF,GAAI,CAACI,eAAe,CAACG,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,CAAC,gCAAgC,CAAC,CAE1E,KAAM,CAAAC,WAAW,CAAG,KAAM,CAAAL,eAAe,CAACM,IAAI,CAAC,CAAC,CAEhDtB,eAAe,CAAC,CACdC,aAAa,CAAE,KAAK,CAAE;AACtBC,OAAO,CAAEmB,WAAW,CAACnB,OAAO,CAC5BC,YAAY,CAAEkB,WAAW,CAAClB,YAAY,CACtCC,SAAS,CAAEiB,WAAW,CAACjB,SAAS,CAChCC,OAAO,CAAE,KACX,CAAC,CAAC,CAEF;AACA,KAAM,CAAAkB,cAAc,CAAG,KAAM,CAAAN,KAAK,gBAAAC,MAAA,CAAgBtB,aAAa,CAACgB,EAAE,oBAAkB,CAAC,CACrF,GAAIW,cAAc,CAACJ,EAAE,CAAE,CACrB,KAAM,CAAAK,MAAM,CAAG,KAAM,CAAAD,cAAc,CAACD,IAAI,CAAC,CAAC,CAC1CX,iBAAiB,CAACa,MAAM,CAAC,CAEzB,GAAIA,MAAM,CAACC,eAAe,CAAE,CAC1BlB,mBAAmB,IAAAW,MAAA,CAAIM,MAAM,CAACC,eAAe,CAACC,KAAK,QAAAR,MAAA,CAAMM,MAAM,CAACC,eAAe,CAACE,QAAQ,CAAE,CAAC,CAC7F,CACF,CAEF,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CACvD5B,eAAe,CAACc,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAET,OAAO,CAAE,KAAK,EAAG,CAAC,CACxD,CACF,CAAC,CAED,KAAM,CAAAyB,aAAa,CAAG,KAAAA,CAAA,GAAY,CAClC,GAAI,CAACxB,gBAAgB,CAAE,OAEvB;AACAuB,OAAO,CAACE,GAAG,CAAC,oBAAoB,CAAEzB,gBAAgB,CAAC,CACnDuB,OAAO,CAACE,GAAG,CAAC,aAAa,CAAEhC,YAAY,CAACK,SAAS,CAAC,CAElD,KAAM,CAAA4B,KAAK,CAAG1B,gBAAgB,CAAC2B,KAAK,CAAC,KAAK,CAAC,CAC3C,GAAID,KAAK,CAACE,MAAM,GAAK,CAAC,CAAE,CACtB,OACF,CAEA,KAAM,CAAAR,KAAK,CAAGM,KAAK,CAAC,CAAC,CAAC,CACtB,KAAM,CAAAL,QAAQ,CAAGK,KAAK,CAAC,CAAC,CAAC,CAEzBH,OAAO,CAACE,GAAG,CAAC,gBAAgB,CAAEL,KAAK,CAAC,CACpCG,OAAO,CAACE,GAAG,CAAC,mBAAmB,CAAEJ,QAAQ,CAAC,CAE1ClB,WAAW,CAAC,IAAI,CAAC,CAEjB,GAAI,CACF,KAAM,CAAA0B,QAAQ,CAAG,KAAM,CAAAlB,KAAK,gBAAAC,MAAA,CAAgBtB,aAAa,CAACgB,EAAE,uBAAsB,CAChFwB,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBd,KAAK,CAAEA,KAAK,CACZC,QAAQ,CAAEA,QAAQ,CAClBvB,SAAS,CAAEL,YAAY,CAACK,SAAW;AACrC,CAAC,CACH,CAAC,CAAC,CAEF,GAAI,CAAC+B,QAAQ,CAAChB,EAAE,CAAE,CAChB,KAAM,CAAAsB,SAAS,CAAG,KAAM,CAAAN,QAAQ,CAACb,IAAI,CAAC,CAAC,CACvC,KAAM,IAAI,CAAAF,KAAK,CAACqB,SAAS,CAACb,KAAK,EAAI,iBAAiB,CAAC,CACvD,CAEA,KAAM,CAAAc,MAAM,CAAG,KAAM,CAAAP,QAAQ,CAACb,IAAI,CAAC,CAAC,CAEpC;AACAzB,oBAAoB,CAAC6C,MAAM,CAACC,eAAe,CAAC,CAE5C;AACAhC,iBAAiB,CAACG,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACjBD,IAAI,MACP8B,eAAe,CAAE,IAAI,CACrBnB,eAAe,CAAE,CAAEC,KAAK,CAAEC,QAAS,CAAC,EACpC,CAAC,CAEL,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAElD,CAAC,OAAS,CACRnB,WAAW,CAAC,KAAK,CAAC,CACpB,CACF,CAAC,CAEC;AACA,GAAI,CAACb,aAAa,EAAI,CAACE,QAAQ,CAAE,MAAO,KAAI,CAE5C;AACA,GAAIC,YAAY,CAACM,OAAO,CAAE,CACxB,mBACEhB,IAAA,QAAKwD,SAAS,CAAC,uCAAuC,CAAAC,QAAA,cACpDvD,KAAA,QAAKsD,SAAS,CAAC,8BAA8B,CAAAC,QAAA,eAC3CzD,IAAA,CAACF,SAAS,EAAC0D,SAAS,CAAC,oCAAoC,CAAE,CAAC,cAC5DxD,IAAA,OAAIwD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,CAAC,6BAA2B,CAAI,CAAC,EACzE,CAAC,CACH,CAAC,CAEV,CAEF;AACAjB,OAAO,CAACE,GAAG,CAAC,gBAAgB,CAAEnC,aAAa,CAACmD,WAAW,CAAC,CACxDlB,OAAO,CAACE,GAAG,CAAC,uBAAuB,MAAAb,MAAA,CAAMtB,aAAa,CAACoD,YAAY,MAAG,CAAC,CACvEnB,OAAO,CAACE,GAAG,CAAC,4BAA4B,CAAE,MAAO,CAAAnC,aAAa,CAACoD,YAAY,CAAC,CAC5EnB,OAAO,CAACE,GAAG,CAAC,+BAA+B,CAAEhC,YAAY,CAACG,OAAO,CAAC,CAClE2B,OAAO,CAACE,GAAG,CAAC,mBAAmB,CAAEjC,QAAQ,CAAC,CAE1C;AACA,GAAKC,YAAY,CAACG,OAAO,EAAIH,YAAY,CAACG,OAAO,CAACgC,MAAM,CAAG,CAAC,EACvD,CAACtC,aAAa,CAACoD,YAAY,EAAIpD,aAAa,CAACoD,YAAY,CAACC,IAAI,CAAC,CAAC,GAAK,EAAE,EAAIrD,aAAa,CAACoD,YAAY,GAAK,GAAI,CAAE,CACjH,mBACEzD,KAAA,QAAKsD,SAAS,CAAC,yDAAyD,CAAAC,QAAA,eACtEvD,KAAA,QAAKsD,SAAS,CAAC,8BAA8B,CAAAC,QAAA,eAC3CzD,IAAA,QAAKwD,SAAS,CAAC,mCAAmC,CAAM,CAAC,cACzDxD,IAAA,OAAIwD,SAAS,CAAC,8BAA8B,CAAAC,QAAA,CAAC,6BAA2B,CAAI,CAAC,EAC1E,CAAC,cAENvD,KAAA,QAAKsD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,EAAC,sBACvB,cAAAzD,IAAA,WAAAyD,QAAA,CAAS/C,YAAY,CAACI,YAAY,CAAS,CAAC,wDAClE,EAAK,CAAC,cAENZ,KAAA,QAAKsD,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxBvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,+CAA+C,CAAAC,QAAA,CAAC,0BAEjE,CAAO,CAAC,cACRvD,KAAA,WACE2D,KAAK,CAAE5C,gBAAiB,CACxB6C,QAAQ,CAAGC,CAAC,EAAK7C,mBAAmB,CAAC6C,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CACrDL,SAAS,CAAC,iHAAiH,CAAAC,QAAA,eAE3HzD,IAAA,WAAQ6D,KAAK,CAAC,EAAE,CAAAJ,QAAA,CAAC,iCAA+B,CAAQ,CAAC,CACxD/C,YAAY,CAACG,OAAO,CAACoD,GAAG,CAAEC,MAAM,eAC/BlE,IAAA,WAA2B6D,KAAK,CAAEK,MAAM,CAACC,KAAM,CAAAV,QAAA,CAC5CS,MAAM,CAACC,KAAK,EADFD,MAAM,CAACL,KAEZ,CACT,CAAC,EACI,CAAC,EACN,CAAC,cAEN3D,KAAA,QAAKsD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCzD,IAAA,WACEoE,OAAO,CAAE5C,mBAAoB,CAC7BgC,SAAS,CAAC,qFAAqF,CAAAC,QAAA,CAChG,iBAED,CAAQ,CAAC,cACTzD,IAAA,WACEoE,OAAO,CAAE3B,aAAc,CACvB4B,QAAQ,CAAE,CAACpD,gBAAgB,EAAIE,QAAS,CACxCqC,SAAS,qDAAA3B,MAAA,CACPZ,gBAAgB,EAAI,CAACE,QAAQ,CACzB,iCAAiC,CACjC,gCAAgC,CACnC,CAAAsC,QAAA,CAEFtC,QAAQ,CAAG,aAAa,CAAG,gBAAgB,CACtC,CAAC,EACN,CAAC,CAEL,CAAAE,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAEe,eAAe,gBAC9BlC,KAAA,QAAKsD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,EAAC,gBAC7B,CAACpC,cAAc,CAACe,eAAe,CAACC,KAAK,CAAC,KAAG,CAAChB,cAAc,CAACe,eAAe,CAACE,QAAQ,CAC9FjB,cAAc,CAACiD,iBAAiB,eAC/BpE,KAAA,SAAMsD,SAAS,CAAC,MAAM,CAAAC,QAAA,EAAC,GAAC,CAAC,GAAI,CAAAc,IAAI,CAAClD,cAAc,CAACiD,iBAAiB,CAAC,CAACE,cAAc,CAAC,CAAC,CAAC,GAAC,EAAM,CAC7F,EACE,CACN,EACE,CAAC,EACH,CAAC,CAEV,CAEA,MAAO,KAAI,CACb,CAAC,CAED,KAAM,CAAAC,cAAc,CAAGA,CAAA,GAAM,KAAAC,sBAAA,CAAAC,uBAAA,CAC3B,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGzF,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAACmB,aAAa,CAAEuE,gBAAgB,CAAC,CAAG1F,QAAQ,CAAC,IAAI,CAAC,CACxD,KAAM,CAACqB,QAAQ,CAAEsE,WAAW,CAAC,CAAG3F,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAAC4F,UAAU,CAAEC,aAAa,CAAC,CAAG7F,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC4B,OAAO,CAAEkE,UAAU,CAAC,CAAG9F,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACmD,KAAK,CAAE4C,QAAQ,CAAC,CAAG/F,QAAQ,CAAC,IAAI,CAAC,CAExC;AACA,KAAM,CAACgG,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGjG,QAAQ,CAAC,KAAK,CAAC,CAC/D,KAAM,CAACkG,YAAY,CAAEC,eAAe,CAAC,CAAGnG,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACoG,aAAa,CAAEC,gBAAgB,CAAC,CAAGrG,QAAQ,CAAC,IAAI,CAAC,CACxD,KAAM,CAACsG,cAAc,CAAEC,iBAAiB,CAAC,CAAGvG,QAAQ,CAAC,CAAC,CAAC,CAEvD,KAAM,CAAAwG,kBAAkB,CAAIC,aAAa,EAAK,CAC5C,GAAI,CAACA,aAAa,CAAE,MAAO,KAAI,CAC/B,gCAAAhE,MAAA,CAAiCgE,aAAa,4CAChD,CAAC,CAED;AACA,KAAM,CAAAC,kBAAkB,CAAG,KAAAA,CAAA,GAAY,CACrC,GAAI,CACF,KAAM,CAAAhD,QAAQ,CAAG,KAAM,CAAAlB,KAAK,CAAC,8BAA8B,CAAC,CAC5D,GAAIkB,QAAQ,CAAChB,EAAE,CAAE,CACf,KAAM,CAAAK,MAAM,CAAG,KAAM,CAAAW,QAAQ,CAACb,IAAI,CAAC,CAAC,CACpCwD,gBAAgB,CAACtD,MAAM,CAAC,CAC1B,CACF,CAAE,MAAOI,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CACzD,CACF,CAAC,CAED;AACA,KAAM,CAAAwD,gBAAgB,CAAIC,KAAK,EAAK,CAClC,KAAM,CAAAC,IAAI,CAAGD,KAAK,CAAChC,MAAM,CAACkC,KAAK,CAAC,CAAC,CAAC,CAClC,GAAID,IAAI,CAAE,CACR;AACA,KAAM,CAAAE,OAAO,CAAG,CAAC,CAAG,IAAI,CAAG,IAAI,CAAE;AACjC,KAAM,CAAAC,YAAY,CAAG,CAAC,YAAY,CAAE,WAAW,CAAE,iBAAiB,CAAC,CAEnE,GAAIH,IAAI,CAACI,IAAI,CAAGF,OAAO,CAAE,CACvBG,KAAK,CAAC,sCAAsC,CAAC,CAC7C,OACF,CAEA,GAAI,CAACF,YAAY,CAACG,QAAQ,CAACN,IAAI,CAACO,IAAI,CAAC,CAAE,CACrCF,KAAK,CAAC,8DAA8D,CAAC,CACrE,OACF,CAEAf,eAAe,CAACU,IAAI,CAAC,CACvB,CACF,CAAC,CAED;AACA,KAAM,CAAAQ,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACtC,GAAI,CAACnB,YAAY,CAAE,OAEnBD,mBAAmB,CAAC,IAAI,CAAC,CACzBM,iBAAiB,CAAC,CAAC,CAAC,CAEpB,GAAI,CACF,KAAM,CAAAe,QAAQ,CAAG,GAAI,CAAAC,QAAQ,CAAC,CAAC,CAC/BD,QAAQ,CAACE,MAAM,CAAC,SAAS,CAAEtB,YAAY,CAAC,CAExC,KAAM,CAAAxC,QAAQ,CAAG,KAAM,CAAAlB,KAAK,kBAAAC,MAAA,CAAkBtB,aAAa,CAACgB,EAAE,oBAAmB,CAC/EwB,MAAM,CAAE,MAAM,CACdE,IAAI,CAAEyD,QACR,CAAC,CAAC,CAEF,GAAI,CAAC5D,QAAQ,CAAChB,EAAE,CAAE,CAChB,KAAM,CAAAsB,SAAS,CAAG,KAAM,CAAAN,QAAQ,CAACb,IAAI,CAAC,CAAC,CACvC,KAAM,IAAI,CAAAF,KAAK,CAACqB,SAAS,CAACb,KAAK,EAAI,eAAe,CAAC,CACrD,CAEA,KAAM,CAAAc,MAAM,CAAG,KAAM,CAAAP,QAAQ,CAACb,IAAI,CAAC,CAAC,CAEpC;AACA6C,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAChBD,IAAI,MACPoF,kBAAkB,CAAE,IAAI,CACxBC,kBAAkB,CAAEzD,MAAM,CAAC0D,GAAG,CAC9BC,uBAAuB,CAAE3D,MAAM,CAAC4D,QAAQ,EACxC,CAAC,CAEH;AACApC,SAAS,CAACD,MAAM,CAACX,GAAG,CAACiD,KAAK,EACxBA,KAAK,CAAC3F,EAAE,GAAKhB,aAAa,CAACgB,EAAE,CAAAG,aAAA,CAAAA,aAAA,IACpBwF,KAAK,MAAEL,kBAAkB,CAAE,IAAI,CAAEC,kBAAkB,CAAEzD,MAAM,CAAC0D,GAAG,GACpEG,KACN,CAAC,CAAC,CAEF;AACA,GAAI7D,MAAM,CAAC8D,OAAO,CAAE,CAClB1B,gBAAgB,CAACpC,MAAM,CAAC8D,OAAO,CAAC,CAClC,CAEA5B,eAAe,CAAC,IAAI,CAAC,CACrBe,KAAK,CAAC,gCAAgC,CAAC,CAEzC,CAAE,MAAO/D,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,eAAe,CAAEA,KAAK,CAAC,CACrC+D,KAAK,mBAAAzE,MAAA,CAAmBU,KAAK,CAAC6E,OAAO,CAAE,CAAC,CAC1C,CAAC,OAAS,CACR/B,mBAAmB,CAAC,KAAK,CAAC,CAC1BM,iBAAiB,CAAC,CAAC,CAAC,CACtB,CACF,CAAC,CAED;AACA,KAAM,CAAA0B,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACtC,GAAI,CAACC,OAAO,CAAC,sDAAsD,CAAC,CAAE,CACpE,OACF,CAEA,GAAI,CACF,KAAM,CAAAxE,QAAQ,CAAG,KAAM,CAAAlB,KAAK,kBAAAC,MAAA,CAAkBtB,aAAa,CAACgB,EAAE,aAAY,CACxEwB,MAAM,CAAE,QACV,CAAC,CAAC,CAEF,GAAI,CAACD,QAAQ,CAAChB,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAC,KAAK,CAAC,0BAA0B,CAAC,CAC7C,CAEA;AACA+C,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAChBD,IAAI,MACPoF,kBAAkB,CAAE,KAAK,CACzBC,kBAAkB,CAAE,IAAI,CACxBE,uBAAuB,CAAE,IAAI,EAC7B,CAAC,CAEH;AACAnC,SAAS,CAACD,MAAM,CAACX,GAAG,CAACiD,KAAK,EACxBA,KAAK,CAAC3F,EAAE,GAAKhB,aAAa,CAACgB,EAAE,CAAAG,aAAA,CAAAA,aAAA,IACpBwF,KAAK,MAAEL,kBAAkB,CAAE,KAAK,CAAEC,kBAAkB,CAAE,IAAI,GAC/DI,KACN,CAAC,CAAC,CAEFZ,KAAK,CAAC,+BAA+B,CAAC,CAExC,CAAE,MAAO/D,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,eAAe,CAAEA,KAAK,CAAC,CACrC+D,KAAK,8BAAAzE,MAAA,CAA8BU,KAAK,CAAC6E,OAAO,CAAE,CAAC,CACrD,CACF,CAAC,CAED,KAAM,CAAAG,iBAAiB,CAAIC,QAAQ,EAAK,KAAAC,oBAAA,CAAAC,qBAAA,CAAAC,qBAAA,CAAAC,qBAAA,CAAAC,qBAAA,CAAAC,qBAAA,CAAAC,qBAAA,CAAAC,oBAAA,CAAAC,qBAAA,CAAAC,WAAA,CAAAC,YAAA,CAAAC,qBAAA,CAAAC,qBAAA,CACtC;AACA7F,OAAO,CAAC8F,KAAK,CAAC,4BAA4B,CAAEd,QAAQ,CAACe,YAAY,CAAC,CAClE/F,OAAO,CAACE,GAAG,CAAC,uBAAuB,CAAE8E,QAAQ,CAAC,CAC9ChF,OAAO,CAACE,GAAG,CAAC,oBAAoB,CAAE,CAAC,CAAC8E,QAAQ,CAACgB,UAAU,CAAC,CACxDhG,OAAO,CAACE,GAAG,CAAC,qBAAqB,CAAE8E,QAAQ,CAACgB,UAAU,CAAC,CACvD,GAAIhB,QAAQ,CAACgB,UAAU,EAAIhB,QAAQ,CAACgB,UAAU,CAAC,CAAC,CAAC,CAAE,CACjDhG,OAAO,CAACE,GAAG,CAAC,kBAAkB,CAAE8E,QAAQ,CAACgB,UAAU,CAAC,CAAC,CAAC,CAAC,CACvDhG,OAAO,CAACE,GAAG,CAAC,sBAAsB,CAAE8E,QAAQ,CAACgB,UAAU,CAAC,CAAC,CAAC,CAACC,aAAa,CAAC,CACzEjG,OAAO,CAACE,GAAG,CAAC,wBAAwB,CAAE,MAAO,CAAA8E,QAAQ,CAACgB,UAAU,CAAC,CAAC,CAAC,CAACC,aAAa,CAAC,CACpF,CACAjG,OAAO,CAACE,GAAG,CAAC,aAAa,CAAE8E,QAAQ,CAACkB,UAAU,CAAC,CAC/ClG,OAAO,CAACE,GAAG,CAAC,mCAAmC,EAAA+E,oBAAA,CAAED,QAAQ,CAACkB,UAAU,UAAAjB,oBAAA,iBAAnBA,oBAAA,CAAqBkB,qBAAqB,CAAC,CAC5FnG,OAAO,CAACoG,QAAQ,CAAC,CAAC,CAClB;AAEA,KAAM,CAAAC,SAAS,CAAGrB,QAAQ,CAACkB,UAAU,EAAI,CAAC,CAAC,CAE3C,GAAI,CAAA7C,aAAa,CAAG,IAAI,CACxB,KAAM,CAAAiD,SAAS,EAAApB,qBAAA,CAAGF,QAAQ,CAACkB,UAAU,UAAAhB,qBAAA,kBAAAC,qBAAA,CAAnBD,qBAAA,CAAqBgB,UAAU,UAAAf,qBAAA,iBAA/BA,qBAAA,CAAiCa,UAAU,CAC7D,GAAIM,SAAS,EAAIA,SAAS,CAAC,CAAC,CAAC,EAAIA,SAAS,CAAC,CAAC,CAAC,CAACC,UAAU,CAAE,CACxD,KAAM,CAAAC,eAAe,CAAGF,SAAS,CAAC,CAAC,CAAC,CAACC,UAAU,CAACE,IAAI,CAACC,IAAI,EAAIA,IAAI,CAACC,IAAI,GAAK,gBAAgB,CAAC,CAC5FtD,aAAa,CAAGmD,eAAe,CAAGA,eAAe,CAACnF,KAAK,CAAG,IAAI,CAChE,CAEA,GAAI,CAAAuF,cAAc,CAAG,qCAAqC,CAC1D,GAAI,CAAAC,cAAc,CAAG,kBAAkB,CAEvC,GAAIP,SAAS,EAAIA,SAAS,CAAC,CAAC,CAAC,EAAIA,SAAS,CAAC,CAAC,CAAC,CAACQ,aAAa,CAAE,CAC3D,KAAM,CAAAC,YAAY,CAAGT,SAAS,CAAC,CAAC,CAAC,CAACQ,aAAa,CAC/C,KAAM,CAAAE,YAAY,CAAGV,SAAS,CAAC,CAAC,CAAC,CAACW,KAAK,EAAIX,SAAS,CAAC,CAAC,CAAC,CAACK,IAAI,EAAI,EAAE,CAElE,GAAII,YAAY,CAAChD,QAAQ,CAAC,qBAAqB,CAAC,CAAE,CAChD6C,cAAc,CAAG,qBAAqB,CACxC,CAAC,IAAM,IAAIG,YAAY,CAAChD,QAAQ,CAAC,sBAAsB,CAAC,CAAE,CACxD6C,cAAc,CAAG,sBAAsB,CACzC,CAAC,IAAM,IAAIG,YAAY,CAAChD,QAAQ,CAAC,aAAa,CAAC,CAAE,CAC/C6C,cAAc,CAAG,oBAAoB,CACvC,CAAC,IAAM,IAAIG,YAAY,CAAChD,QAAQ,CAAC,UAAU,CAAC,CAAE,CAC5C6C,cAAc,CAAG,iBAAiB,CACpC,CAAC,IAAM,CACL,GAAII,YAAY,CAACE,WAAW,CAAC,CAAC,CAACnD,QAAQ,CAAC,SAAS,CAAC,CAAE,CAClD6C,cAAc,CAAG,qBAAqB,CACxC,CAAC,IAAM,IAAII,YAAY,CAACE,WAAW,CAAC,CAAC,CAACnD,QAAQ,CAAC,SAAS,CAAC,CAAE,CACzD6C,cAAc,CAAG,sBAAsB,CACzC,CAAC,IAAM,CACLA,cAAc,CAAG,qCAAqC,CACxD,CACF,CACF,CAEA,KAAM,CAAAO,YAAY,CAAG,EAAA/B,qBAAA,CAAAJ,QAAQ,CAACkB,UAAU,UAAAd,qBAAA,kBAAAC,qBAAA,CAAnBD,qBAAA,CAAqBc,UAAU,UAAAb,qBAAA,kBAAAC,qBAAA,CAA/BD,qBAAA,CAAiC+B,sBAAsB,UAAA9B,qBAAA,kBAAAC,qBAAA,CAAvDD,qBAAA,CAA0D,CAAC,CAAC,UAAAC,qBAAA,iBAA5DA,qBAAA,CAA8D4B,YAAY,GAAI,CAAC,CAAC,CAErG,KAAM,CAAAZ,UAAU,CAAG,CAAC,CAAC,CACrB,KAAM,CAAAc,UAAU,CAAG,CAAC,GAAG,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAC,CAEtDA,UAAU,CAACC,OAAO,CAACC,GAAG,EAAI,CACxB;AACA,KAAM,CAAAC,cAAc,CAAGxC,QAAQ,cAAA3F,MAAA,CAAckI,GAAG,CAACL,WAAW,CAAC,CAAC,EAAG,CACjE,GAAIM,cAAc,CAAE,CAClBjB,UAAU,cAAAlH,MAAA,CAAckI,GAAG,EAAG,CAAGC,cAAc,CACjD,CAAC,IAAM,CACL;AACA,KAAM,CAAAC,WAAW,CAAGN,YAAY,CAACI,GAAG,CAAC,CACrC,GAAIE,WAAW,CAAE,CACf,GAAI,MAAO,CAAAA,WAAW,GAAK,QAAQ,EAAI,OAAO,EAAI,CAAAA,WAAW,CAAE,CAC7D,KAAM,CAAAC,YAAY,CAAGD,WAAW,CAACE,IAAI,IAAAtI,MAAA,CAC9BoI,WAAW,CAACpG,KAAK,MAAAhC,MAAA,CAAIoI,WAAW,CAACE,IAAI,EACxCF,WAAW,CAACpG,KAAK,CACrBkF,UAAU,cAAAlH,MAAA,CAAckI,GAAG,EAAG,CAAGG,YAAY,CAC/C,CAAC,IAAM,CACLnB,UAAU,cAAAlH,MAAA,CAAckI,GAAG,EAAG,CAAGK,MAAM,CAACH,WAAW,CAAC,CACtD,CACF,CAAC,IAAM,CACLlB,UAAU,cAAAlH,MAAA,CAAckI,GAAG,EAAG,CAAG,EAAE,CACrC,CACF,CACF,CAAC,CAAC,CAEF;AACA,KAAM,CAAAM,iBAAiB,CAAG,EAAArC,oBAAA,CAAAR,QAAQ,CAACgB,UAAU,UAAAR,oBAAA,kBAAAC,qBAAA,CAAnBD,oBAAA,CAAsB,CAAC,CAAC,UAAAC,qBAAA,iBAAxBA,qBAAA,CAA0BQ,aAAa,GAAII,SAAS,CAACF,qBAAqB,EAAI,EAAE,CAC1GnG,OAAO,CAACE,GAAG,CAAC,kCAAkC,CAAE2H,iBAAiB,CAAC,CAElE,MAAO,CACL9I,EAAE,CAAEiG,QAAQ,CAACjG,EAAE,CAAC+I,QAAQ,CAAC,CAAC,CAC1B5G,WAAW,CAAE8D,QAAQ,CAACe,YAAY,EAAI,SAAS,CAC/CgC,QAAQ,CAAE,CACRpB,IAAI,CAAE3B,QAAQ,CAACgD,aAAa,EAAI,kBAAkB,CAClDC,KAAK,CAAEjD,QAAQ,CAACkD,cAAc,EAAI,EACpC,CAAC,CACDC,SAAS,CAAEnD,QAAQ,CAACoD,YAAY,CAAG,GAAI,CAAArG,IAAI,CAACiD,QAAQ,CAACoD,YAAY,CAAC,CAACC,WAAW,CAAC,CAAC,CAACjI,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAG,EAAE,CACnGT,MAAM,CAAEqF,QAAQ,CAACsD,iBAAiB,GAAK,UAAU,CAAG,gBAAgB,CAAG,eAAe,CACtFC,SAAS,CAAEvD,QAAQ,CAACwD,UAAU,EAAI,KAAK,CACvClC,SAAS,CAAE,CAAC,CACVmC,GAAG,CAAEpC,SAAS,CAACoC,GAAG,GAAInC,SAAS,SAATA,SAAS,kBAAAZ,WAAA,CAATY,SAAS,CAAG,CAAC,CAAC,UAAAZ,WAAA,iBAAdA,WAAA,CAAgB+C,GAAG,GAAI,aAAa,CAC1DzB,YAAY,CAAE,CAAAV,SAAS,SAATA,SAAS,kBAAAX,YAAA,CAATW,SAAS,CAAG,CAAC,CAAC,UAAAX,YAAA,iBAAdA,YAAA,CAAgBsB,KAAK,GAAI,iBAAiB,CACxDyB,QAAQ,CAAE,CAAC,CACXnC,UAAU,CAAEA,UACd,CAAC,CAAC,CACFpF,YAAY,CAAE6D,QAAQ,CAAC2D,aAAa,IAAA/C,qBAAA,CAAIZ,QAAQ,CAACgB,UAAU,UAAAJ,qBAAA,kBAAAC,qBAAA,CAAnBD,qBAAA,CAAsB,CAAC,CAAC,UAAAC,qBAAA,iBAAxBA,qBAAA,CAA0BI,aAAa,GAAII,SAAS,CAACF,qBAAqB,EAAI,EAAE,CACxHyC,WAAW,CAAEvC,SAAS,CAACuC,WAAW,EAAI,EAAE,CACxCvF,aAAa,CAAEA,aAAa,CAC5BwF,eAAe,CAAEzF,kBAAkB,CAACC,aAAa,CAAC,CAClDuD,cAAc,CAAE5B,QAAQ,CAAC8D,eAAe,EAAIlC,cAAc,CAC1DC,cAAc,CAAE7B,QAAQ,CAAC+D,eAAe,EAAIlC,cAAc,CAC1DmC,eAAe,CAAEhE,QAAQ,CAACiE,iBAAiB,EAAI,EAAE,CACjDC,kBAAkB,CAAElE,QAAQ,CAACmE,oBAAoB,EAAI,EAAE,CACvDC,eAAe,CAAEpE,QAAQ,CAACqE,iBAAiB,EAAI,EAAE,CACjDC,UAAU,CAAEtE,QAAQ,CAACuE,WAAW,CAChCC,YAAY,CAAExE,QAAQ,CAACyE,aAAa,EAAIpD,SAAS,CAACmD,YAAY,CAC9DE,eAAe,CAAEvC,YAAY,CAC7BwC,KAAK,CAAE3E,QAAQ,CAAC2E,KAAK,EAAI,EAAE,CAC3BC,aAAa,CAAE5E,QAAQ,CAAC6E,cAAc,EAAI,mBAAmB,CAC7D;AACAxF,kBAAkB,CAAEW,QAAQ,CAACX,kBAAkB,EAAI,KAAK,CACxDC,kBAAkB,CAAEU,QAAQ,CAACV,kBAAkB,EAAI,IAAI,CACvDE,uBAAuB,CAAEQ,QAAQ,CAACV,kBAAkB,CAAGU,QAAQ,CAACV,kBAAkB,CAAClE,KAAK,CAAC,GAAG,CAAC,CAAC0J,GAAG,CAAC,CAAC,CAAG,IACxG,CAAC,CACH,CAAC,CAED,KAAM,CAAAC,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,KAAAC,mBAAA,CACFtH,UAAU,CAAC,IAAI,CAAC,CAChBC,QAAQ,CAAC,IAAI,CAAC,CAEd,KAAM,CAAArC,QAAQ,CAAG,KAAM,CAAAlB,KAAK,CAAC,aAAa,CAAC,CAC3C,GAAI,CAACkB,QAAQ,CAAChB,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAC,KAAK,4BAAAF,MAAA,CAA4BiB,QAAQ,CAACX,MAAM,CAAE,CAAC,CAC/D,CAEA,KAAM,CAAAsK,WAAW,CAAG,KAAM,CAAA3J,QAAQ,CAACb,IAAI,CAAC,CAAC,CAEzC;AACAO,OAAO,CAAC8F,KAAK,CAAC,uBAAuB,CAAC,CACtC9F,OAAO,CAACE,GAAG,CAAC,oBAAoB,CAAE+J,WAAW,CAAC,CAC9CjK,OAAO,CAACE,GAAG,CAAC,mBAAmB,EAAA8J,mBAAA,CAAEC,WAAW,CAAC7H,MAAM,UAAA4H,mBAAA,iBAAlBA,mBAAA,CAAoB3J,MAAM,CAAC,CAC5D,GAAI4J,WAAW,CAAC7H,MAAM,EAAI6H,WAAW,CAAC7H,MAAM,CAAC,CAAC,CAAC,CAAE,CAC/CpC,OAAO,CAACE,GAAG,CAAC,uBAAuB,CAAE+J,WAAW,CAAC7H,MAAM,CAAC,CAAC,CAAC,CAAC,CAC3DpC,OAAO,CAACE,GAAG,CAAC,yBAAyB,CAAE+J,WAAW,CAAC7H,MAAM,CAAC,CAAC,CAAC,CAAC4D,UAAU,CAAC,CAC1E,CACAhG,OAAO,CAACoG,QAAQ,CAAC,CAAC,CAClB;AAEA,KAAM,CAAA8D,WAAW,CAAGD,WAAW,CAAC7H,MAAM,EAAI,EAAE,CAC5C,KAAM,CAAA+H,iBAAiB,CAAGD,WAAW,CAACzI,GAAG,CAACsD,iBAAiB,CAAC,CAC5D1C,SAAS,CAAC8H,iBAAiB,CAAC,CAE9B,CAAE,MAAOC,GAAG,CAAE,CACZpK,OAAO,CAACD,KAAK,CAAC,wBAAwB,CAAEqK,GAAG,CAAC,CAC5CzH,QAAQ,CAACyH,GAAG,CAACxF,OAAO,CAAC,CACvB,CAAC,OAAS,CACRlC,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED7F,SAAS,CAAC,IAAM,CACdkN,WAAW,CAAC,CAAC,CACbzG,kBAAkB,CAAC,CAAC,CACpB,KAAM,CAAA+G,QAAQ,CAAGC,WAAW,CAAC,IAAM,CACjC,GAAI,CAACrM,QAAQ,CAAE,CACb8L,WAAW,CAAC,CAAC,CACf,CACF,CAAC,CAAE,KAAK,CAAC,CACT,MAAO,IAAMQ,aAAa,CAACF,QAAQ,CAAC,CACtC,CAAC,CAAE,CAACpM,QAAQ,CAAC,CAAC,CAEd,KAAM,CAAAuM,iBAAiB,CAAI9F,KAAK,EAAK,CACnC,GAAI,CAAA3G,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEgB,EAAE,IAAK2F,KAAK,CAAC3F,EAAE,CAAE,CAClCuD,gBAAgB,CAAC,IAAI,CAAC,CACtBC,WAAW,CAAC,KAAK,CAAC,CACpB,CAAC,IAAM,CACLD,gBAAgB,CAAApD,aAAA,IAAMwF,KAAK,CAAE,CAAC,CAC9BnC,WAAW,CAAC,KAAK,CAAC,CAClBQ,eAAe,CAAC,IAAI,CAAC,CAAE;AACzB,CACF,CAAC,CAED,KAAM,CAAA0H,UAAU,CAAGA,CAAA,GAAMlI,WAAW,CAAC,IAAI,CAAC,CAE1C,KAAM,CAAAmI,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC7B,GAAI,KAAAC,qBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CACF,KAAM,CAAA9K,QAAQ,CAAG,KAAM,CAAAlB,KAAK,gBAAAC,MAAA,CAAgBtB,aAAa,CAACgB,EAAE,EAAI,CAC9DwB,MAAM,CAAE,KAAK,CACbC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnB2H,iBAAiB,CAAEvK,aAAa,CAAC4B,MAAM,GAAK,eAAe,CAAG,WAAW,CAAG,UAAU,CACtFgK,KAAK,CAAE5L,aAAa,CAAC4L,KAAK,CAC1BE,cAAc,CAAE9L,aAAa,CAAC6L,aAAa,CAC3C7D,YAAY,CAAEhI,aAAa,CAACmD,WAAW,CACvC8G,aAAa,CAAEjK,aAAa,CAACgK,QAAQ,CAACpB,IAAI,CAC1CuB,cAAc,CAAEnK,aAAa,CAACgK,QAAQ,CAACE,KAAK,CAC5CoD,UAAU,CAAEtN,aAAa,CAACoK,SAAS,CACnCQ,aAAa,CAAE5K,aAAa,CAACoD,YAAY,CACzCmK,WAAW,EAAAX,qBAAA,CAAE5M,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAAqE,qBAAA,iBAA1BA,qBAAA,CAA4BlC,GAAG,CAC5CC,QAAQ,EAAAkC,sBAAA,CAAE7M,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAAsE,sBAAA,iBAA1BA,sBAAA,CAA4BlC,QAAQ,CAC9C6C,WAAW,EAAAV,sBAAA,CAAE9M,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAAuE,sBAAA,iBAA1BA,sBAAA,CAA4BtE,UAAU,CAAC,aAAa,CAAC,CAClEiF,WAAW,EAAAV,sBAAA,CAAE/M,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAAwE,sBAAA,iBAA1BA,sBAAA,CAA4BvE,UAAU,CAAC,aAAa,CAAC,CAClEkF,WAAW,EAAAV,sBAAA,CAAEhN,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAAyE,sBAAA,iBAA1BA,sBAAA,CAA4BxE,UAAU,CAAC,aAAa,CAAC,CAClEmF,WAAW,EAAAV,sBAAA,CAAEjN,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAA0E,sBAAA,iBAA1BA,sBAAA,CAA4BzE,UAAU,CAAC,aAAa,CAAC,CAClEoF,WAAW,EAAAV,sBAAA,CAAElN,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAA2E,sBAAA,iBAA1BA,sBAAA,CAA4B1E,UAAU,CAAC,aAAa,CAAC,CAClEqF,WAAW,EAAAV,sBAAA,CAAEnN,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAA4E,sBAAA,iBAA1BA,sBAAA,CAA4B3E,UAAU,CAAC,aAAa,CAAC,CAClEsF,WAAW,EAAAV,sBAAA,CAAEpN,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAA6E,sBAAA,iBAA1BA,sBAAA,CAA4B5E,UAAU,CAAC,aAAa,CAAC,CAClE0C,iBAAiB,CAAElL,aAAa,CAACiL,eAAe,CAChDG,oBAAoB,CAAEpL,aAAa,CAACmL,kBAAkB,CACtDG,iBAAiB,CAAEtL,aAAa,CAACqL,eAAe,CAChDN,eAAe,CAAE/K,aAAa,CAAC6I,cAAc,CAC7CmC,eAAe,CAAEhL,aAAa,CAAC8I,cAAc,CAC7CM,YAAY,CAAE,EAAAiE,sBAAA,CAAArN,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAA8E,sBAAA,iBAA1BA,sBAAA,CAA4B7E,UAAU,GAAI,CAAC,CAC3D,CAAC,CACH,CAAC,CAAC,CAEF,KAAM,CAAA1F,MAAM,CAAG,KAAM,CAAAP,QAAQ,CAACb,IAAI,CAAC,CAAC,CACpCO,OAAO,CAACE,GAAG,CAAC,gBAAgB,CAAEW,MAAM,CAAC,CAErC,GAAI,CAACP,QAAQ,CAAChB,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAC,KAAK,kBAAAF,MAAA,CAAkBiB,QAAQ,CAACX,MAAM,CAAE,CAAC,CACrD,CAEA0C,SAAS,CAACD,MAAM,CAACX,GAAG,CAACiD,KAAK,EACxBA,KAAK,CAAC3F,EAAE,GAAKhB,aAAa,CAACgB,EAAE,CAAGhB,aAAa,CAAG2G,KAClD,CAAC,CAAC,CAEFnC,WAAW,CAAC,KAAK,CAAC,CAEpB,CAAE,MAAO6H,GAAG,CAAE,CACZpK,OAAO,CAACD,KAAK,CAAC,qBAAqB,CAAEqK,GAAG,CAAC,CAC3C,CACF,CAAC,CAED,KAAM,CAAA0B,YAAY,CAAGA,CAAA,GAAM,CACzB,KAAM,CAAAC,aAAa,CAAG3J,MAAM,CAACqE,IAAI,CAAC/B,KAAK,EAAIA,KAAK,CAAC3F,EAAE,GAAKhB,aAAa,CAACgB,EAAE,CAAC,CACzEuD,gBAAgB,CAAApD,aAAA,IAAM6M,aAAa,CAAE,CAAC,CACtCxJ,WAAW,CAAC,KAAK,CAAC,CAClBQ,eAAe,CAAC,IAAI,CAAC,CAAE;AACzB,CAAC,CAED,KAAM,CAAAiJ,gBAAgB,CAAGA,CAACC,KAAK,CAAE5K,KAAK,GAAK,CACzCiB,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAE,CAACgN,KAAK,EAAG5K,KAAK,EAAG,CAAC,CACzD,CAAC,CAED,KAAM,CAAA6K,mBAAmB,CAAGA,CAACD,KAAK,CAAE5K,KAAK,GAAK,CAC5CiB,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAChBD,IAAI,MACP8I,QAAQ,CAAA7I,aAAA,CAAAA,aAAA,IAAOD,IAAI,CAAC8I,QAAQ,MAAE,CAACkE,KAAK,EAAG5K,KAAK,EAAE,EAC9C,CAAC,CACL,CAAC,CAED,KAAM,CAAA8K,iBAAiB,CAAGA,CAACC,SAAS,CAAE/K,KAAK,GAAK,CAC9CiB,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAChBD,IAAI,MACPqH,SAAS,CAAErH,IAAI,CAACqH,SAAS,CAAC7E,GAAG,CAAC4K,IAAI,EAAAnN,aAAA,CAAAA,aAAA,IAC7BmN,IAAI,MACP9F,UAAU,CAAArH,aAAA,CAAAA,aAAA,IAAOmN,IAAI,CAAC9F,UAAU,MAAE,CAAC6F,SAAS,EAAG/K,KAAK,EAAE,EACtD,CAAC,EACH,CAAC,CACL,CAAC,CAED,KAAM,CAAAiL,qBAAqB,CAAGA,CAACL,KAAK,CAAE5K,KAAK,GAAK,CAC9CiB,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAE,CAACgN,KAAK,EAAG5K,KAAK,EAAG,CAAC,CACzD,CAAC,CAED,KAAM,CAAAkL,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,CACFvM,OAAO,CAACE,GAAG,CAAC,2BAA2B,CAAEnC,aAAa,CAACmD,WAAW,CAAC,CAEnE,KAAM,CAAAZ,QAAQ,CAAG,KAAM,CAAAlB,KAAK,CAAC,mBAAmB,CAAE,CAChDmB,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnB+D,KAAK,CAAE3G,aACT,CAAC,CACH,CAAC,CAAC,CAEF,GAAI,CAACuC,QAAQ,CAAChB,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAC,KAAK,CAAC,wBAAwB,CAAC,CAC3C,CAEA,KAAM,CAAAiN,IAAI,CAAG,KAAM,CAAAlM,QAAQ,CAACkM,IAAI,CAAC,CAAC,CAClC,KAAM,CAAAjI,GAAG,CAAGkI,MAAM,CAACC,GAAG,CAACC,eAAe,CAACH,IAAI,CAAC,CAC5C,KAAM,CAAAI,CAAC,CAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC,CACrCF,CAAC,CAACG,IAAI,CAAGxI,GAAG,CACZqI,CAAC,CAACI,QAAQ,UAAA3N,MAAA,CAAYtB,aAAa,CAACmD,WAAW,MAAA7B,MAAA,CAAItB,aAAa,CAACgK,QAAQ,CAACpB,IAAI,CAACsG,OAAO,CAAC,MAAM,CAAE,GAAG,CAAC,QAAM,CACzGJ,QAAQ,CAACpM,IAAI,CAACyM,WAAW,CAACN,CAAC,CAAC,CAC5BA,CAAC,CAACO,KAAK,CAAC,CAAC,CACTN,QAAQ,CAACpM,IAAI,CAAC2M,WAAW,CAACR,CAAC,CAAC,CAC5BH,MAAM,CAACC,GAAG,CAACW,eAAe,CAAC9I,GAAG,CAAC,CAEjC,CAAE,MAAO6F,GAAG,CAAE,CACZpK,OAAO,CAACD,KAAK,CAAC,uBAAuB,CAAEqK,GAAG,CAAC,CAC3CtG,KAAK,CAAC,wBAAwB,CAAC,CACjC,CACF,CAAC,CAED,KAAM,CAAAwJ,gBAAgB,CAAI9D,YAAY,EAAK,CACzC,KAAM,CAAA+D,cAAc,CAAG,CACrB,qBAAqB,CAAE,wBAAwB,CAC/C,0BAA0B,CAAE,+BAC9B,CAAC,CAED,MAAO,CAAAA,cAAc,CAAC/D,YAAY,CAAC,EAAI,8BAA8B,CACvE,CAAC,CAED,KAAM,CAAAgE,YAAY,CAAGA,CAAA,GAAM,CACzBxN,OAAO,CAACE,GAAG,CAAC,gBAAgB,CAAEnC,aAAa,CAACyL,YAAY,CAAC,CACzD,KAAM,CAAAiE,aAAa,CAAGH,gBAAgB,CAACvP,aAAa,CAACyL,YAAY,CAAC,CAClE,KAAM,CAAAkE,OAAO,mBAAArO,MAAA,CAAqBtB,aAAa,CAACmD,WAAW,QAAA7B,MAAA,CAAMtB,aAAa,CAACgK,QAAQ,CAACpB,IAAI,CAAE,CAE9F;AACA8F,MAAM,CAACkB,IAAI,CAAC,kCAAkC,CAAE,QAAQ,CAAC,CAEzD;AACAC,UAAU,CAAC,IAAM,CACf9J,KAAK,wDAAAzE,MAAA,CAAwDoO,aAAa,gBAAApO,MAAA,CAAcqO,OAAO,gDAA8C,CAAC,CAChJ,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAED,KAAM,CAAAG,eAAe,CAAG,KAAAA,CAAA,GAAY,CAClC,KAAM,CAAAvN,QAAQ,CAAG,KAAM,CAAAlB,KAAK,gBAAAC,MAAA,CAAgBtB,aAAa,CAACgB,EAAE,EAAI,CAC9DwB,MAAM,CAAE,KAAK,CACbC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAE6H,UAAU,CAAE,IAAK,CAAC,CAC3C,CAAC,CAAC,CAEF,GAAIlI,QAAQ,CAAChB,EAAE,CAAE,CACf+C,SAAS,CAACD,MAAM,CAACX,GAAG,CAACiD,KAAK,EACxBA,KAAK,CAAC3F,EAAE,GAAKhB,aAAa,CAACgB,EAAE,CAAAG,aAAA,CAAAA,aAAA,IAAQwF,KAAK,MAAE6D,SAAS,CAAE,IAAI,GAAK7D,KAClE,CAAC,CAAC,CACFpC,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAEsJ,SAAS,CAAE,IAAI,EAAG,CAAC,CAC1D,CAAC,IAAM,CACLzE,KAAK,eAAAzE,MAAA,CAAeiB,QAAQ,CAACX,MAAM,CAAE,CAAC,CACxC,CACF,CAAC,CAED,KAAM,CAAAmO,cAAc,CAAG1L,MAAM,CAAC2L,MAAM,CAACrJ,KAAK,EACxCA,KAAK,CAACxD,WAAW,CAACgG,WAAW,CAAC,CAAC,CAACnD,QAAQ,CAACvB,UAAU,CAAC0E,WAAW,CAAC,CAAC,CAAC,EAClExC,KAAK,CAACqD,QAAQ,CAACpB,IAAI,CAACO,WAAW,CAAC,CAAC,CAACnD,QAAQ,CAACvB,UAAU,CAAC0E,WAAW,CAAC,CAAC,CACrE,CAAC,CAED,GAAI1I,OAAO,CAAE,CACX,mBACEhB,IAAA,QAAKwD,SAAS,CAAC,2DAA2D,CAAAC,QAAA,cACxEvD,KAAA,QAAKsD,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BzD,IAAA,QAAKwD,SAAS,CAAC,sEAAsE,CAAM,CAAC,cAC5FxD,IAAA,MAAGwD,SAAS,CAAC,qBAAqB,CAAAC,QAAA,CAAC,mBAAiB,CAAG,CAAC,EACrD,CAAC,CACH,CAAC,CAEV,CAEA,GAAIlB,KAAK,CAAE,CACT,mBACEvC,IAAA,QAAKwD,SAAS,CAAC,2DAA2D,CAAAC,QAAA,cACxEvD,KAAA,QAAKsD,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BvD,KAAA,MAAGsD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,EAAC,wBAAsB,CAAClB,KAAK,EAAI,CAAC,cAClEvC,IAAA,WACEoE,OAAO,CAAEmI,WAAY,CACrB/I,SAAS,CAAC,4DAA4D,CAAAC,QAAA,CACvE,OAED,CAAQ,CAAC,EACN,CAAC,CACH,CAAC,CAEV,CAEA,mBACEvD,KAAA,QAAKsD,SAAS,CAAC,0BAA0B,CAAAC,QAAA,eACvCzD,IAAA,QAAKwD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,cAC1CzD,IAAA,QAAKwD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,cAC1CvD,KAAA,QAAKsD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAChDvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,OAAIwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,kCAElD,CAAI,CAAC,cACLzD,IAAA,MAAGwD,SAAS,CAAC,qBAAqB,CAAAC,QAAA,CAAC,+DAEnC,CAAG,CAAC,CACH+B,aAAa,EAAIA,aAAa,CAACgL,UAAU,CAAG,EAAE,eAC7CtQ,KAAA,QAAKsD,SAAS,CAAC,6CAA6C,CAAAC,QAAA,eAC1DzD,IAAA,CAACH,aAAa,EAACwG,IAAI,CAAE,EAAG,CAAE,CAAC,cAC3BnG,KAAA,SAAMsD,SAAS,CAAC,SAAS,CAAAC,QAAA,EAAC,UAChB,CAAC+B,aAAa,CAACgL,UAAU,CAAC,UAAQ,CAAChL,aAAa,CAACiL,IAAI,CAAC,GAAC,CAACjL,aAAa,CAACkL,KAAK,CAAC,GACtF,EAAM,CAAC,EACJ,CACN,EACE,CAAC,cACNxQ,KAAA,QAAKsD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,EACpCmB,MAAM,CAAC/B,MAAM,CAAC,gBACf,cAAA7C,IAAA,WACEoE,OAAO,CAAEmI,WAAY,CACrB/I,SAAS,CAAC,4EAA4E,CAAAC,QAAA,CACvF,SAED,CAAQ,CAAC,EACN,CAAC,EACH,CAAC,CACH,CAAC,CACH,CAAC,cAENzD,IAAA,QAAKwD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,cACpCvD,KAAA,QAAKsD,SAAS,CAAC,uCAAuC,CAAAC,QAAA,eAEpDzD,IAAA,QAAKwD,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC5BvD,KAAA,QAAKsD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAChDvD,KAAA,QAAKsD,SAAS,CAAC,0BAA0B,CAAAC,QAAA,eACvCzD,IAAA,OAAIwD,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CAAC,cAAY,CAAI,CAAC,cAC5DzD,IAAA,UACEwG,IAAI,CAAC,MAAM,CACXmK,WAAW,CAAC,kBAAkB,CAC9BnN,SAAS,CAAC,oCAAoC,CAC9CK,KAAK,CAAEmB,UAAW,CAClBlB,QAAQ,CAAGC,CAAC,EAAKkB,aAAa,CAAClB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAChD,CAAC,EACC,CAAC,cAEN7D,IAAA,QAAKwD,SAAS,CAAC,0BAA0B,CAAAC,QAAA,CACtC6M,cAAc,CAACzN,MAAM,GAAK,CAAC,cAC1B7C,IAAA,QAAKwD,SAAS,CAAC,gCAAgC,CAAAC,QAAA,CAC5CuB,UAAU,CAAG,6BAA6B,CAAG,iBAAiB,CAC5D,CAAC,CAENsL,cAAc,CAACrM,GAAG,CAAEiD,KAAK,eACvBlH,IAAA,QAEEwD,SAAS,kDAAA3B,MAAA,CACP,CAAAtB,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEgB,EAAE,IAAK2F,KAAK,CAAC3F,EAAE,CAAG,YAAY,CAAG,EAAE,CACjD,CACH6C,OAAO,CAAEA,CAAA,GAAM4I,iBAAiB,CAAC9F,KAAK,CAAE,CAAAzD,QAAA,cAExCvD,KAAA,QAAKsD,SAAS,CAAC,kCAAkC,CAAAC,QAAA,eAC/CvD,KAAA,QAAKsD,SAAS,CAAC,QAAQ,CAAAC,QAAA,eACrBvD,KAAA,QAAKsD,SAAS,CAAC,8BAA8B,CAAAC,QAAA,eAC3CzD,IAAA,SAAMwD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAEyD,KAAK,CAACxD,WAAW,CAAO,CAAC,CACjEwD,KAAK,CAACrB,aAAa,eAClB3F,KAAA,SAAMsD,SAAS,CAAC,qEAAqE,CAAAC,QAAA,EAAC,QAC9E,CAACyD,KAAK,CAACrB,aAAa,EACtB,CACP,CACAqB,KAAK,CAACL,kBAAkB,eACvB7G,IAAA,SAAMwD,SAAS,CAAC,yEAAyE,CAAAC,QAAA,CAAC,QAE1F,CAAM,CACP,CACAyD,KAAK,CAACiF,KAAK,eACVnM,IAAA,SAAMwD,SAAS,CAAC,yEAAyE,CAAAC,QAAA,CAAC,OAE1F,CAAM,CACP,EACE,CAAC,cACNzD,IAAA,QAAKwD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,CAAEyD,KAAK,CAACqD,QAAQ,CAACpB,IAAI,CAAM,CAAC,cACnEnJ,IAAA,QAAKwD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,CAAEyD,KAAK,CAACyD,SAAS,CAAM,CAAC,CAC9DzD,KAAK,CAAC8E,YAAY,eACjB9L,KAAA,QAAKsD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,EAAC,SAAE,CAACyD,KAAK,CAAC8E,YAAY,EAAM,CACzE,EAEE,CAAC,cACNhM,IAAA,QAAAyD,QAAA,cACEzD,IAAA,SAAMwD,SAAS,8BAAA3B,MAAA,CACbqF,KAAK,CAAC6D,SAAS,CACT,6BAA6B,CAC7B7D,KAAK,CAAC/E,MAAM,GAAK,eAAe,CAChC,+BAA+B,CAC/B,2BAA2B,CAC9B,CAAAsB,QAAA,CACFyD,KAAK,CAAC6D,SAAS,CAAG,MAAM,CAAI7D,KAAK,CAAC/E,MAAM,GAAK,eAAe,CAAG,OAAO,CAAG,QAAS,CAC7E,CAAC,CACN,CAAC,EACH,CAAC,EA5CD+E,KAAK,CAAC3F,EA6CR,CACN,CACF,CACE,CAAC,EACH,CAAC,CACH,CAAC,cAENvB,IAAA,QAAKwD,SAAS,CAAC,eAAe,CAAAC,QAAA,CAC3BlD,aAAa,cACZL,KAAA,QAAKsD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAChDvD,KAAA,QAAKsD,SAAS,CAAC,4DAA4D,CAAAC,QAAA,eACzEvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,OAAIwD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,eAAa,CAAI,CAAC,cACxDzD,IAAA,MAAGwD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,CAAElD,aAAa,CAACmD,WAAW,CAAI,CAAC,EAClE,CAAC,cACN1D,IAAA,QAAKwD,SAAS,CAAC,YAAY,CAAAC,QAAA,CACxB,CAAChD,QAAQ,cACRP,KAAA,CAAAE,SAAA,EAAAqD,QAAA,eACEvD,KAAA,WACEkE,OAAO,CAAE6I,UAAW,CACpBzJ,SAAS,CAAC,oFAAoF,CAAAC,QAAA,eAE9FzD,IAAA,CAACR,KAAK,EAAC6G,IAAI,CAAE,EAAG,CAAE,CAAC,OAErB,EAAQ,CAAC,cACTnG,KAAA,WACEkE,OAAO,CAAE2K,WAAY,CACrBvL,SAAS,CAAC,sFAAsF,CAAAC,QAAA,eAEhGzD,IAAA,CAACV,QAAQ,EAAC+G,IAAI,CAAE,EAAG,CAAE,CAAC,eAExB,EAAQ,CAAC,cACTnG,KAAA,WACAkE,OAAO,CAAE,KAAAA,CAAA,GAAY,CACjB,GAAI,CACA;AACA,KAAM,CAAA2K,WAAW,CAAC,CAAC,CAEnB;AACA,KAAM,CAAA6B,aAAa,CAAG,KAAM,CAAAhP,KAAK,CAAC,iBAAiB,CAAE,CACjDmB,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACjB0N,EAAE,CAAE,8BAA8B,CAAG;AACrCX,OAAO,mBAAArO,MAAA,CAAoBtB,aAAa,CAACmD,WAAW,QAAA7B,MAAA,CAAMtB,aAAa,CAACgK,QAAQ,CAACpB,IAAI,CAAE,CACvFlG,IAAI,sXAAApB,MAAA,CAKyCtB,aAAa,CAACmD,WAAW,2FAAA7B,MAAA,CAC7BtB,aAAa,CAACgK,QAAQ,CAACpB,IAAI,gMAGnE,CACD2H,OAAO,CAAEvQ,aAAa,CAACgB,EAAE,CACzBsH,SAAS,CAAEtI,aAAe;AAC9B,CAAC,CACL,CAAC,CAAC,CAEF,GAAI,CAACqQ,aAAa,CAAC9O,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,CAAC,sBAAsB,CAAC,CAE9D;AACA,KAAM,CAAAsO,eAAe,CAAC,CAAC,CACvB/J,KAAK,CAAC,6CAA6C,CAAC,CAExD,CAAE,MAAO/D,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,QAAQ,CAAEA,KAAK,CAAC,CAC9B+D,KAAK,YAAAzE,MAAA,CAAYU,KAAK,CAAC6E,OAAO,CAAE,CAAC,CACrC,CACJ,CAAE,CACF5D,SAAS,CAAC,wFAAwF,CAAAC,QAAA,eAEhGzD,IAAA,CAACT,IAAI,EAAC8G,IAAI,CAAE,EAAG,CAAE,CAAC,cAClBrG,IAAA,CAACV,QAAQ,EAAC+G,IAAI,CAAE,EAAG,CAAE,CAAC,qBAExB,EAAQ,CAAC,EACT,CAAC,cAEHnG,KAAA,CAAAE,SAAA,EAAAqD,QAAA,eACEvD,KAAA,WACEkE,OAAO,CAAE8I,UAAW,CACpB1J,SAAS,CAAC,sFAAsF,CAAAC,QAAA,eAEhGzD,IAAA,CAACP,IAAI,EAAC4G,IAAI,CAAE,EAAG,CAAE,CAAC,OAEpB,EAAQ,CAAC,cACTnG,KAAA,WACEkE,OAAO,CAAEkK,YAAa,CACtB9K,SAAS,CAAC,sFAAsF,CAAAC,QAAA,eAEhGzD,IAAA,CAACN,CAAC,EAAC2G,IAAI,CAAE,EAAG,CAAE,CAAC,SAEjB,EAAQ,CAAC,EACT,CACH,CACE,CAAC,EACH,CAAC,cAENnG,KAAA,QAAKsD,SAAS,CAAC,eAAe,CAAAC,QAAA,eAE5BvD,KAAA,QAAKsD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCzD,IAAA,OAAIwD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,gBAAc,CAAI,CAAC,cACtDzD,IAAA,aACE6D,KAAK,CAAEtD,aAAa,CAAC4L,KAAM,CAC3BrI,QAAQ,CAAGC,CAAC,EAAKyK,gBAAgB,CAAC,OAAO,CAAEzK,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC3DQ,QAAQ,CAAE,CAAC5D,QAAS,CACpBkQ,WAAW,CAAC,4BAA4B,CACxCI,IAAI,CAAE,CAAE,CACRvN,SAAS,CAAC,uDAAuD,CAClE,CAAC,EACC,CAAC,cAENtD,KAAA,QAAKsD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCzD,IAAA,OAAIwD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,mBAAiB,CAAI,CAAC,cACzDvD,KAAA,QAAKsD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,cAAY,CAAO,CAAC,cACzEzD,IAAA,UACEwG,IAAI,CAAC,MAAM,CACX3C,KAAK,CAAEtD,aAAa,CAACmD,WAAY,CACjCI,QAAQ,CAAGC,CAAC,EAAKyK,gBAAgB,CAAC,aAAa,CAAEzK,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CACjEQ,QAAQ,CAAE,CAAC5D,QAAS,CACpB+C,SAAS,CAAC,uDAAuD,CAClE,CAAC,EACC,CAAC,cACNtD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,YAAU,CAAO,CAAC,cACvEzD,IAAA,UACEwG,IAAI,CAAC,MAAM,CACX3C,KAAK,CAAEtD,aAAa,CAACoK,SAAU,CAC/B7G,QAAQ,CAAGC,CAAC,EAAKyK,gBAAgB,CAAC,WAAW,CAAEzK,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC/DQ,QAAQ,CAAE,CAAC5D,QAAS,CACpB+C,SAAS,CAAC,uDAAuD,CAClE,CAAC,EACC,CAAC,EACH,CAAC,EACH,CAAC,cAENtD,KAAA,QAAKsD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCzD,IAAA,OAAIwD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,sBAAoB,CAAI,CAAC,cAC5DvD,KAAA,QAAKsD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,eAAa,CAAO,CAAC,cAC1EzD,IAAA,UACEwG,IAAI,CAAC,MAAM,CACX3C,KAAK,CAAEtD,aAAa,CAACgK,QAAQ,CAACpB,IAAK,CACnCrF,QAAQ,CAAGC,CAAC,EAAK2K,mBAAmB,CAAC,MAAM,CAAE3K,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC7DQ,QAAQ,CAAE,CAAC5D,QAAS,CACpB+C,SAAS,CAAC,uDAAuD,CAClE,CAAC,EACC,CAAC,cACNtD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,OAAK,CAAO,CAAC,cAClEzD,IAAA,UACEwG,IAAI,CAAC,OAAO,CACZ3C,KAAK,CAAEtD,aAAa,CAACgK,QAAQ,CAACE,KAAM,CACpC3G,QAAQ,CAAGC,CAAC,EAAK2K,mBAAmB,CAAC,OAAO,CAAE3K,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC9DQ,QAAQ,CAAE,CAAC5D,QAAS,CACpB+C,SAAS,CAAC,uDAAuD,CAClE,CAAC,EACC,CAAC,EACH,CAAC,EACH,CAAC,cAENtD,KAAA,QAAKsD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCzD,IAAA,OAAIwD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,qBAAmB,CAAI,CAAC,cAG3DvD,KAAA,QAAKsD,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,eAAa,CAAO,CAAC,cAC1EzD,IAAA,aACE6D,KAAK,CAAEtD,aAAa,CAACoD,YAAa,CAClCG,QAAQ,CAAGC,CAAC,EAAKyK,gBAAgB,CAAC,cAAc,CAAEzK,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAClEQ,QAAQ,CAAE,CAAC5D,QAAS,CACpBsQ,IAAI,CAAE,CAAE,CACRvN,SAAS,CAAC,qFAAqF,CAChG,CAAC,EACC,CAAC,cAGNxD,IAAA,CAACK,uBAAuB,EACtBE,aAAa,CAAEA,aAAc,CAC7BC,oBAAoB,CAAGwQ,OAAO,EAAK,CACjClM,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAEkC,YAAY,CAAEqN,OAAO,EAAG,CAAC,CAC9DnM,SAAS,CAACD,MAAM,CAACX,GAAG,CAACiD,KAAK,EACxBA,KAAK,CAAC3F,EAAE,GAAKhB,aAAa,CAACgB,EAAE,CAAAG,aAAA,CAAAA,aAAA,IACpBwF,KAAK,MAAEvD,YAAY,CAAEqN,OAAO,GACjC9J,KACN,CAAC,CAAC,CACJ,CAAE,CACFzG,QAAQ,CAAEA,QAAS,CACpB,CAAC,cAGFP,KAAA,QAAKsD,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzBvD,KAAA,QAAKsD,SAAS,CAAC,QAAQ,CAAAC,QAAA,eACrBzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,aAAW,CAAO,CAAC,cACxEzD,IAAA,UACEwG,IAAI,CAAC,MAAM,CACX3C,KAAK,CAAE,EAAAa,sBAAA,CAAAnE,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAApE,sBAAA,iBAA1BA,sBAAA,CAA4BuG,GAAG,GAAI,aAAc,CACxD5G,QAAQ,MACRb,SAAS,CAAC,sDAAsD,CACjE,CAAC,EACC,CAAC,cAENtD,KAAA,QAAKsD,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,KAAG,CAAO,CAAC,cAChEzD,IAAA,UACEwG,IAAI,CAAC,QAAQ,CACb3C,KAAK,CAAE,EAAAc,uBAAA,CAAApE,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAAnE,uBAAA,iBAA1BA,uBAAA,CAA4BuG,QAAQ,GAAI,CAAE,CACjDpH,QAAQ,CAAGC,CAAC,EAAK,CACf,KAAM,CAAAkN,WAAW,CAAGC,QAAQ,CAACnN,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,EAAI,CAAC,CACjDiB,gBAAgB,CAACrD,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAChBD,IAAI,MACPqH,SAAS,CAAErH,IAAI,CAACqH,SAAS,CAAC7E,GAAG,CAAC,CAAC4K,IAAI,CAAEsC,KAAK,GACxCA,KAAK,GAAK,CAAC,CAAAzP,aAAA,CAAAA,aAAA,IAAQmN,IAAI,MAAE3D,QAAQ,CAAE+F,WAAW,GAAKpC,IACrD,CAAC,EACD,CAAC,CACL,CAAE,CACFxK,QAAQ,CAAE,CAAC5D,QAAS,CACpB+C,SAAS,CAAC,mEAAmE,CAC7E4N,GAAG,CAAC,GAAG,CACPC,GAAG,CAAC,IAAI,CACT,CAAC,EACC,CAAC,EACH,CAAC,CAEL9Q,aAAa,CAACyL,YAAY,eACzB9L,KAAA,QAAKsD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,EAAC,eAC9B,cAAAzD,IAAA,SAAMwD,SAAS,CAAC,aAAa,CAAAC,QAAA,CAAElD,aAAa,CAACyL,YAAY,CAAO,CAAC,EAC3E,CACN,EACE,CAAC,cAEN9L,KAAA,QAAKsD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCzD,IAAA,OAAIwD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,8BAA4B,CAAI,CAAC,cAEpEvD,KAAA,QAAKsD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,OAAIwD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,CAAC,YAAU,CAAI,CAAC,cAC3DzD,IAAA,QAAKwD,SAAS,CAAC,WAAW,CAAAC,QAAA,CACvB,CAAC,aAAa,CAAE,aAAa,CAAE,aAAa,CAAE,aAAa,CAAE,aAAa,CAAE,aAAa,CAAE,aAAa,CAAC,CAACQ,GAAG,CAAE2K,SAAS,EAAK,KAAA0C,uBAAA,CAC5H,KAAM,CAAAzN,KAAK,CAAG,EAAAyN,uBAAA,CAAA/Q,aAAa,CAACuI,SAAS,CAAC,CAAC,CAAC,UAAAwI,uBAAA,iBAA1BA,uBAAA,CAA4BvI,UAAU,CAAC6F,SAAS,CAAC,GAAI,EAAE,CACrE,KAAM,CAAA2C,QAAQ,CAAG1N,KAAK,EAAIA,KAAK,GAAK,EAAE,CAEtC,mBACE3D,KAAA,QAAqBsD,SAAS,CAAC,yBAAyB,CAAAC,QAAA,eACtDzD,IAAA,UAAOwD,SAAS,CAAC,qCAAqC,CAAAC,QAAA,CACnDmL,SAAS,CAACa,OAAO,CAAC,YAAY,CAAE,EAAE,CAAC,CAC/B,CAAC,cACRzP,IAAA,UACEwG,IAAI,CAAC,MAAM,CACX3C,KAAK,CAAEA,KAAM,CACbC,QAAQ,CAAGC,CAAC,EAAK4K,iBAAiB,CAACC,SAAS,CAAE7K,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC9DQ,QAAQ,CAAE,CAAC5D,QAAS,CACpBkQ,WAAW,CAAC,cAAc,CAC1BnN,SAAS,oEAAA3B,MAAA,CACP0P,QAAQ,CAAG,gBAAgB,CAAG,gBAAgB,CAC7C,CACJ,CAAC,CACDA,QAAQ,EAAI,CAAC9Q,QAAQ,eACpBT,IAAA,SAAMwD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,CAAC,QAAC,CAAM,CACjD,GAhBOmL,SAiBL,CAAC,CAEV,CAAC,CAAC,CACC,CAAC,cAEN1O,KAAA,QAAKsD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eACjCzD,IAAA,OAAIwD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,CAAC,2BAAyB,CAAI,CAAC,cAC1EvD,KAAA,QAAKsD,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxBvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,sBAAoB,CAAO,CAAC,cACjFzD,IAAA,UACEwG,IAAI,CAAC,MAAM,CACX3C,KAAK,CAAEtD,aAAa,CAACiL,eAAe,EAAI,EAAG,CAC3C1H,QAAQ,CAAGC,CAAC,EAAK+K,qBAAqB,CAAC,iBAAiB,CAAE/K,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC1EQ,QAAQ,CAAE,CAAC5D,QAAS,CACpBkQ,WAAW,CAAC,cAAc,CAC1BnN,SAAS,CAAC,uDAAuD,CAClE,CAAC,EACC,CAAC,cACNtD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,yBAAuB,CAAO,CAAC,cACpFzD,IAAA,UACEwG,IAAI,CAAC,MAAM,CACX3C,KAAK,CAAEtD,aAAa,CAACmL,kBAAkB,EAAI,EAAG,CAC9C5H,QAAQ,CAAGC,CAAC,EAAK+K,qBAAqB,CAAC,oBAAoB,CAAE/K,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC7EQ,QAAQ,CAAE,CAAC5D,QAAS,CACpBkQ,WAAW,CAAC,cAAc,CAC1BnN,SAAS,CAAC,uDAAuD,CAClE,CAAC,EACC,CAAC,cACNtD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,+BAA6B,CAAO,CAAC,cAC1FzD,IAAA,UACEwG,IAAI,CAAC,MAAM,CACX3C,KAAK,CAAEtD,aAAa,CAACqL,eAAe,EAAI,EAAG,CAC3C9H,QAAQ,CAAGC,CAAC,EAAK+K,qBAAqB,CAAC,iBAAiB,CAAE/K,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC1EQ,QAAQ,CAAE,CAAC5D,QAAS,CACpBkQ,WAAW,CAAC,oBAAoB,CAChCnN,SAAS,CAAC,uDAAuD,CAClE,CAAC,EACC,CAAC,EACH,CAAC,EACH,CAAC,EACH,CAAC,cAENtD,KAAA,QAAAuD,QAAA,eACEvD,KAAA,OAAIsD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,EAAC,eAE1C,CAAClD,aAAa,CAACsF,aAAa,eAC1B3F,KAAA,SAAMsD,SAAS,CAAC,sEAAsE,CAAAC,QAAA,EAAC,QAC/E,CAAClD,aAAa,CAACsF,aAAa,EAC9B,CACP,CACAtF,aAAa,CAACsG,kBAAkB,eAC/B7G,IAAA,SAAMwD,SAAS,CAAC,0EAA0E,CAAAC,QAAA,CAAC,gBAE3F,CAAM,CACP,EACC,CAAC,cAELzD,IAAA,QAAKwD,SAAS,CAAC,4BAA4B,CAACgO,KAAK,CAAE,CAACC,MAAM,CAAE,OAAO,CAAE,CAAAhO,QAAA,CAClElD,aAAa,CAACsG,kBAAkB,EAAItG,aAAa,CAACuG,kBAAkB,cACnE5G,KAAA,QAAKsD,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC5BzD,IAAA,QACE0R,GAAG,CAAEnR,aAAa,CAACuG,kBAAmB,CACtC6K,GAAG,6BAAA9P,MAAA,CAA8BtB,aAAa,CAACmD,WAAW,CAAG,CAC7DF,SAAS,CAAC,8BAA8B,CACxCoO,OAAO,CAAG7N,CAAC,EAAK,CACdvB,OAAO,CAACD,KAAK,CAAC,gCAAgC,CAAEhC,aAAa,CAACuG,kBAAkB,CAAC,CACjF/C,CAAC,CAACC,MAAM,CAACwN,KAAK,CAACK,OAAO,CAAG,MAAM,CAC/B9N,CAAC,CAACC,MAAM,CAAC8N,WAAW,CAACN,KAAK,CAACK,OAAO,CAAG,MAAM,CAC7C,CAAE,CACH,CAAC,cACF3R,KAAA,QAAKsD,SAAS,CAAC,0EAA0E,CAAAC,QAAA,eACvFzD,IAAA,QAAKwD,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,+BAA6B,CAAK,CAAC,cACjEzD,IAAA,QAAKwD,SAAS,CAAC,SAAS,CAAAC,QAAA,CAAElD,aAAa,CAACyG,uBAAuB,CAAM,CAAC,EACnE,CAAC,EACH,CAAC,CACJzG,aAAa,CAAC8K,eAAe,cAC/BnL,KAAA,QAAKsD,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC5BzD,IAAA,QACE0R,GAAG,CAAEnR,aAAa,CAAC8K,eAAgB,CACnCsG,GAAG,UAAA9P,MAAA,CAAWtB,aAAa,CAACsF,aAAa,sBAAqB,CAC9DrC,SAAS,CAAC,8BAA8B,CACxCoO,OAAO,CAAG7N,CAAC,EAAK,CACdvB,OAAO,CAACD,KAAK,CAAC,yBAAyB,CAAEhC,aAAa,CAAC8K,eAAe,CAAC,CACvEtH,CAAC,CAACC,MAAM,CAACwN,KAAK,CAACK,OAAO,CAAG,MAAM,CAC/B9N,CAAC,CAACC,MAAM,CAAC8N,WAAW,CAACN,KAAK,CAACK,OAAO,CAAG,MAAM,CAC7C,CAAE,CACH,CAAC,cACF3R,KAAA,QAAKsD,SAAS,CAAC,0EAA0E,CAAAC,QAAA,eACvFzD,IAAA,QAAKwD,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,wBAAsB,CAAK,CAAC,cAC1DvD,KAAA,QAAKsD,SAAS,CAAC,SAAS,CAAAC,QAAA,EAAC,SAAO,CAAClD,aAAa,CAACsF,aAAa,EAAM,CAAC,cACnE3F,KAAA,QAAKsD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,EAAC,gCACb,CAAClD,aAAa,CAACsF,aAAa,CAAC,yCAC7D,EAAK,CAAC,EACH,CAAC,EACH,CAAC,cAEN3F,KAAA,QAAKsD,SAAS,CAAC,wEAAwE,CAAAC,QAAA,eACrFzD,IAAA,QAAKwD,SAAS,CAAC,cAAc,CAAAC,QAAA,CAC1BlD,aAAa,CAACsF,aAAa,CAAG,uCAAuC,CAAG,sBAAsB,CAC5F,CAAC,CACLtF,aAAa,CAACsF,aAAa,eAC1B3F,KAAA,QAAKsD,SAAS,CAAC,SAAS,CAAAC,QAAA,EAAC,SAAO,CAAClD,aAAa,CAACsF,aAAa,EAAM,CACnE,CACA,CAACtF,aAAa,CAACsF,aAAa,eAC3B7F,IAAA,QAAKwD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,CAAC,8CAE7C,CAAK,CACN,EACE,CACN,CACE,CAAC,CAGLhD,QAAQ,eACPP,KAAA,QAAKsD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eACjCzD,IAAA,OAAIwD,SAAS,CAAC,0BAA0B,CAAAC,QAAA,CAAC,uBAAqB,CAAI,CAAC,CAElE+B,aAAa,EAAIA,aAAa,CAACgL,UAAU,CAAG,EAAE,eAC7CtQ,KAAA,QAAKsD,SAAS,CAAC,gFAAgF,CAAAC,QAAA,eAC7FzD,IAAA,CAACH,aAAa,EAACwG,IAAI,CAAE,EAAG,CAAE,CAAC,uBACP,CAACb,aAAa,CAACgL,UAAU,CAAC,UAAQ,CAAChL,aAAa,CAACiL,IAAI,CAAC,GAAC,CAACjL,aAAa,CAACkL,KAAK,CAAC,GAClG,EAAK,CACN,cAED1Q,IAAA,UACEwG,IAAI,CAAC,MAAM,CACXuL,MAAM,CAAC,sBAAsB,CAC7BjO,QAAQ,CAAEiC,gBAAiB,CAC3BvC,SAAS,CAAC,0KAA0K,CACrL,CAAC,CAED8B,YAAY,eACXpF,KAAA,QAAKsD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,eAC1CvD,KAAA,MAAGsD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,EAAC,YACzB,CAAC6B,YAAY,CAAC6D,IAAI,CAAC,IAAE,CAAC,CAAC7D,YAAY,CAACe,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE2L,OAAO,CAAC,CAAC,CAAC,CAAC,KAC3E,EAAG,CAAC,cACJ9R,KAAA,QAAKsD,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eAC9BvD,KAAA,WACEkE,OAAO,CAAEqC,mBAAoB,CAC7BpC,QAAQ,CAAEe,gBAAiB,CAC3B5B,SAAS,CAAC,gHAAgH,CAAAC,QAAA,eAE1HzD,IAAA,CAACL,MAAM,EAAC0G,IAAI,CAAE,EAAG,CAAE,CAAC,CACnBjB,gBAAgB,CAAG,cAAc,CAAG,gBAAgB,EAC/C,CAAC,cACTpF,IAAA,WACEoE,OAAO,CAAEA,CAAA,GAAMmB,eAAe,CAAC,IAAI,CAAE,CACrC/B,SAAS,CAAC,sEAAsE,CAAAC,QAAA,CACjF,QAED,CAAQ,CAAC,EACN,CAAC,EACH,CACN,CAEAlD,aAAa,CAACsG,kBAAkB,eAC/B3G,KAAA,QAAKsD,SAAS,CAAC,8BAA8B,CAAAC,QAAA,eAC3CvD,KAAA,MAAGsD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,EAAC,2BAChB,CAAClD,aAAa,CAACyG,uBAAuB,EAC9D,CAAC,cACJ9G,KAAA,WACEkE,OAAO,CAAEiD,mBAAoB,CAC7B7D,SAAS,CAAC,0FAA0F,CAAAC,QAAA,eAEpGzD,IAAA,CAACJ,MAAM,EAACyG,IAAI,CAAE,EAAG,CAAE,CAAC,wBAEtB,EAAQ,CAAC,EACN,CACN,cAEDrG,IAAA,QAAKwD,SAAS,CAAC,6BAA6B,CAAAC,QAAA,CAAC,sDAE7C,CAAK,CAAC,EACH,CACN,EACE,CAAC,EACH,CAAC,EACH,CAAC,cAENvD,KAAA,QAAKsD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCzD,IAAA,OAAIwD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,uBAAqB,CAAI,CAAC,cAC7DvD,KAAA,QAAKsD,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,iBAAe,CAAO,CAAC,cAC5EvD,KAAA,WACE2D,KAAK,CAAEtD,aAAa,CAAC6I,cAAe,CACpCtF,QAAQ,CAAGC,CAAC,EAAKyK,gBAAgB,CAAC,gBAAgB,CAAEzK,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CACpEQ,QAAQ,CAAE,CAAC5D,QAAS,CACpB+C,SAAS,CAAC,uDAAuD,CAAAC,QAAA,eAEjEzD,IAAA,WAAQ6D,KAAK,CAAC,wBAAwB,CAAAJ,QAAA,CAAC,qCAAmC,CAAQ,CAAC,cACnFzD,IAAA,WAAQ6D,KAAK,CAAC,sBAAsB,CAAAJ,QAAA,CAAC,sBAAoB,CAAQ,CAAC,cAClEzD,IAAA,WAAQ6D,KAAK,CAAC,qBAAqB,CAAAJ,QAAA,CAAC,qBAAmB,CAAQ,CAAC,cAChEzD,IAAA,WAAQ6D,KAAK,CAAC,uBAAoB,CAAAJ,QAAA,CAAC,uBAAkB,CAAQ,CAAC,cAC9DzD,IAAA,WAAQ6D,KAAK,CAAC,oBAAiB,CAAAJ,QAAA,CAAC,oBAAe,CAAQ,CAAC,EAClD,CAAC,EACN,CAAC,cACNvD,KAAA,QAAAuD,QAAA,eACEzD,IAAA,UAAOwD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAAC,iBAAe,CAAO,CAAC,cAC5EvD,KAAA,WACE2D,KAAK,CAAEtD,aAAa,CAAC8I,cAAe,CACpCvF,QAAQ,CAAGC,CAAC,EAAKyK,gBAAgB,CAAC,gBAAgB,CAAEzK,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CACpEQ,QAAQ,CAAE,CAAC5D,QAAS,CACpB+C,SAAS,CAAC,uDAAuD,CAAAC,QAAA,eAEjEzD,IAAA,WAAQ6D,KAAK,CAAC,kBAAkB,CAAAJ,QAAA,CAAC,kBAAgB,CAAQ,CAAC,cAC1DzD,IAAA,WAAQ6D,KAAK,CAAC,wBAAwB,CAAAJ,QAAA,CAAC,wBAAsB,CAAQ,CAAC,EAChE,CAAC,EACN,CAAC,EACH,CAAC,EACH,CAAC,cAENvD,KAAA,QAAKsD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCzD,IAAA,OAAIwD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,gBAAc,CAAI,CAAC,cACtDvD,KAAA,WACE2D,KAAK,CAAEtD,aAAa,CAAC6L,aAAc,CACnCtI,QAAQ,CAAGC,CAAC,EAAKyK,gBAAgB,CAAC,eAAe,CAAEzK,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CACnEQ,QAAQ,CAAE,CAAC5D,QAAS,CACpB+C,SAAS,CAAC,uDAAuD,CAAAC,QAAA,eAEjEzD,IAAA,WAAQ6D,KAAK,CAAC,mBAAmB,CAAAJ,QAAA,CAAC,oBAAkB,CAAQ,CAAC,cAC7DzD,IAAA,WAAQ6D,KAAK,CAAC,qBAAqB,CAAAJ,QAAA,CAAC,sBAAoB,CAAQ,CAAC,cACjEzD,IAAA,WAAQ6D,KAAK,CAAC,qBAAqB,CAAAJ,QAAA,CAAC,uBAAqB,CAAQ,CAAC,EAC5D,CAAC,EACN,CAAC,EAEH,CAAC,EACH,CAAC,cAENzD,IAAA,QAAKwD,SAAS,CAAC,mDAAmD,CAAAC,QAAA,cAChEvD,KAAA,QAAKsD,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BzD,IAAA,QAAKwD,SAAS,CAAC,wBAAwB,CAACyO,IAAI,CAAC,MAAM,CAACC,MAAM,CAAC,cAAc,CAACC,OAAO,CAAC,WAAW,CAAA1O,QAAA,cAC3FzD,IAAA,SAAMoS,aAAa,CAAC,OAAO,CAACC,cAAc,CAAC,OAAO,CAACC,WAAW,CAAE,CAAE,CAACC,CAAC,CAAC,sHAAsH,CAAE,CAAC,CAC3L,CAAC,cACNvS,IAAA,OAAIwD,SAAS,CAAC,yCAAyC,CAAAC,QAAA,CAAC,iBAAe,CAAI,CAAC,cAC5EzD,IAAA,MAAGwD,SAAS,CAAC,gBAAgB,CAAAC,QAAA,CAAC,6DAA2D,CAAG,CAAC,EAC1F,CAAC,CACH,CACN,CACE,CAAC,EACH,CAAC,CACH,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAgB,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}